(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{153:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var i=n(0),a=n.n(i);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=a.a.createContext({}),d=function(e){var t=a.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=d(e.components);return a.a.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},p=a.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,r=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),b=d(n),p=i,u=b["".concat(r,".").concat(p)]||b[p]||h[p]||o;return n?a.a.createElement(u,s(s({ref:t},c),{},{components:n})):a.a.createElement(u,s({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var c=2;c<o;c++)r[c]=n[c];return a.a.createElement.apply(null,r)}return a.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},226:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/intro_pic-0466ceeb09f76d82676c1c00dc70335d.png"},227:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/create_trigger_form-5e91e4c320d7e7d58398065cbb509a45.jpg"},228:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/conditions_example_1-39cee6e9c10e295feef793babd79e3fd.jpg"},229:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/conditions_example_2-3a4d1b7893cf5bded155e92e312a166d.jpg"},230:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/conditions_example_3-9b1c8b5ac5f9104d768e3368bb1d9a74.jpg"},231:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/actions_example_1-57cb1a21b54d3bb83f7ddd63e4cdadd9.jpg"},232:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/actions_example_email-69fb057328b6739d27b9d508aae8f082.jpg"},233:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/actions_example_2-0badb2a86c7310b1cd6d738132fc91ce.png"},234:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/actions_example_3-6e41dc7a8465c6e8ff995282287cc630.png"},94:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return d}));var i=n(2),a=n(6),o=(n(0),n(153)),r={id:"a-guide-to-triggers",title:"A guide to Triggers"},s={unversionedId:"guides/a-guide-to-triggers",id:"guides/a-guide-to-triggers",isDocsHomePage:!1,title:"A guide to Triggers",description:"The possibilities are endless with the AutoPi device. This guide will be introducing and explaining how to use, create and edit",source:"@site/docs/guides/a_guide_to_triggers.md",slug:"/guides/a-guide-to-triggers",permalink:"/guides/a-guide-to-triggers",version:"current",sidebar:"guidesSidebar",previous:{title:"4G internet setup troubleshooting",permalink:"/guides/4g-internet-setup-troubleshooting"},next:{title:"AutoPi GPIO pinout",permalink:"/guides/autopi-gpio-pinout"}},l=[{value:"What are triggers?",id:"what-are-triggers",children:[]},{value:"Here&#39;s how to start",id:"heres-how-to-start",children:[]},{value:"Conditions",id:"conditions",children:[{value:"Examples",id:"examples",children:[]}]},{value:"Actions",id:"actions",children:[{value:"Examples",id:"examples-1",children:[]}]},{value:"Discussion",id:"discussion",children:[]}],c={rightToc:l};function d(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(i.a)({},c,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The possibilities are endless with the AutoPi device. This guide will be introducing and explaining how to use, create and edit\ntriggers with your device. Triggers will allow you to get notifications both based on events from the device, but also all the\nvarious data points, that are logged from the car."),Object(o.b)("p",null,Object(o.b)("img",{alt:"intro_pic",src:n(226).default})," "),Object(o.b)("h2",{id:"what-are-triggers"},"What are triggers?"),Object(o.b)("p",null,"Triggers are a way to receive notifications when specific events occur on the device. Conditions can also be set on the triggers so\nthat the notifications are only sent when those conditions have been met."),Object(o.b)("p",null,"More specifically, whenever a device recieves an event (e.g. ",Object(o.b)("inlineCode",{parentName:"p"},"vehicle/engine/running"),") it will push that event and the data that comes\nwith it to the Cloud. When the Cloud system receives that data, it'll process it and find out if there are any triggers that need to\nbe executed based on the event name (also known as a tag) and the conditions for each trigger that matches the tag."),Object(o.b)("p",null,"You can set up or edit these triggers on the AutoPi Cloud. As mentioned earlier, triggers are based on event from the device, and\na trigger can have zero or more conditions that needs to be met before it is triggered. Once the condition(s) have been met, the\ntrigger will execute the attached action(s), i.e. a notification will be sent to you notifying you of this event, either via email\nor a webhook request."),Object(o.b)("p",null,"In this guide we will explore how you can setup a trigger on your own. We will create a trigger that will notify you whenever your\nvehicle has been started outside of specified hours - 8 PM until 8 AM. We will make use of the event ",Object(o.b)("inlineCode",{parentName:"p"},"vehicle/engine/running"),", which\nis fired when the vehicle's engine is started."),Object(o.b)("h2",{id:"heres-how-to-start"},"Here's how to start"),Object(o.b)("p",null,"Once, you have received your AutoPi device, and you have registered it (click ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://www.autopi.io/getting-started/"}),"HERE")," to see\nthe getting started guide, if you have not already done so) and you are all set to go and can begin creating your own triggers.\nLet's get started with the guide."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Firstly, we need to go over to the Triggers page. You can find it by logging into ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://my.autopi.io"}),"https://my.autopi.io"),' and selecting the\n"Triggers" option from the menu. There, you\'ll see a "Create" button. When you press that button a pop-up window will show up with\nthe form to create a trigger.')),Object(o.b)("p",null,Object(o.b)("img",{alt:"create_trigger_form",src:n(227).default})),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Next, let's fill out that form. We'll go through the options that are available in the form and explain each one of them."),Object(o.b)("ol",{parentName:"li"},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Description")," - This is a descriptive name of your trigger. You can set it to whatever suits you, but for this guide, we will\ngo with 'Vehicle started outside of working hours'.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Last Triggered")," - This shows the time the trigger was last triggered. The same form is used to view and edit the trigger,\nso you are able to open it up and view that. This is also visible on the overview of your triggers.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Enabled")," - Whether the trigger is enabled.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Type")," - This is the type of event that the trigger will be reacting on. For right now, only one option is available -\nEvent, which is a device event, however in the future, there will be types like Alert, OBD Data and more.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Tag")," - The event tag that the trigger is going to be fired on. This needs to either be a full event tag, like\n",Object(o.b)("inlineCode",{parentName:"p"},"vehicle/engine/running")," or a more general specification with the use of regular expressions like ",Object(o.b)("inlineCode",{parentName:"p"},"vehicle/engine/*"),". For this\nguide we will be using ",Object(o.b)("inlineCode",{parentName:"p"},"vehicle/engine/running")," in this field.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Conditions")," - Here, you can specify different conditions for your trigger. Conditions are going to be reviewed deeper\nin a subsection later in this guide, but for now, we will set two conditions: one field ",Object(o.b)("inlineCode",{parentName:"p"},"@ts")," with data ",Object(o.b)("inlineCode",{parentName:"p"},"time")," should be less\nthan ",Object(o.b)("inlineCode",{parentName:"p"},"08:00:00")," and a second field ",Object(o.b)("inlineCode",{parentName:"p"},"@ts")," with data ",Object(o.b)("inlineCode",{parentName:"p"},"time")," should be greater than ",Object(o.b)("inlineCode",{parentName:"p"},"20:00:00"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Actions")," - This is where you specify the actions that are to be executed when the trigger is fired. You can choose from two\noptions as of now: sending an email and sending a webhook request. For this guide, we will use only the sending an email option\nto send an email to ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"mailto:support@autopi.io"}),"support@autopi.io")," (which is also the email you should use if you have any questions for this or any other\nguide \ud83d\ude09).  We will review the different options that you have when sending a webhook request further into this guide.")))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Finally, let's click on the create button to create our new trigger."))),Object(o.b)("h2",{id:"conditions"},"Conditions"),Object(o.b)("p",null,"In this section we will explore the fields available in the conditions."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("em",{parentName:"li"},"Field")," - The field is the name of a field that is present in the event's data. This means values like the date and time of when the event\nhas been triggered, the vehicle ID and the unit ID of the device are available. A basic event data can look like the following:")),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),'{\n    "@rec": "2021-05-25T12:33:52.636385Z", # when was the event recieved by the Cloud\n    "@t": "event.vehicle.engine",          # the event type\n    "@tag": "vehicle/engine/running",      # the event tag\n    "@ts": "2021-05-25T12:33:42.686380Z",  # when was the event fired on the device\n    "@uid": "ee3df171-ff0f-6209-a3db-aa00b00e1d05",  # the unit ID of the device\n    "@vid": 106                            # vehicle ID\n}\n')),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Type")," - The type field will be set based on the field you selected. But there are situations where you might want to specify the type\nto something else than the preselected value. One situation is when you want a trigger that will only execute at certain times of the day,\nlike after 8 in the evening. In that case, you would first select a timestamp field (in this case @ts), and then change the type from datetime,\nto time. This way the date part of the @ts will be ignored. Note that the timestamps are in UTC, so the comparison value should also be UTC.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Not"),' - Check the "Not" checkbox if you want the condition to be inverted. For example, you can use that with the "field present" operator,\nto make a condition that only executes if the field is NOT present.')),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Operator")," - We also need to select the operator, which will decide how the comparison is performed. Not all operators makes sense on all\ntypes. For example, you would probably not use the comparison operators (greater than, etc.) for a string types.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"Value")," - Finally, input whatever value should be used when comparing the field value. For example:"),Object(o.b)("ol",{parentName:"li"},Object(o.b)("li",{parentName:"ol"},'some.field should "be present" ',Object(o.b)("strong",{parentName:"li"},"(in this case no value is needed)")),Object(o.b)("li",{parentName:"ol"},'some.field should "equal" ',Object(o.b)("strong",{parentName:"li"},"1234")),Object(o.b)("li",{parentName:"ol"},'some.field should be "greater than" ',Object(o.b)("strong",{parentName:"li"},"0"))))),Object(o.b)("h3",{id:"examples"},"Examples"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Notify on engine start between 01:00 and 06:00 at night."),"\n(Remember all times are UTC, so keep that in mind when creating the conditions. So if your timezone is UTC+2, the below conditions will in\nreality match between 03:00:00 to 08:00:00 local time.)"),Object(o.b)("p",null,Object(o.b)("img",{alt:"conditions_example_1",src:n(228).default})," "),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Notify on device update (No conditions)")),Object(o.b)("p",null,Object(o.b)("img",{alt:"conditions_example_2",src:n(229).default})," "),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Notify on all events (will only execute once every minute no matter how many events are received)")),Object(o.b)("p",null,Object(o.b)("img",{alt:"conditions_example_3",src:n(230).default})," "),Object(o.b)("h2",{id:"actions"},"Actions"),Object(o.b)("p",null,"When you speicfy you'd like to send a webhook request, you can specify the payload that is sent with the request. When specifying the payload, you can\nuse the Jinja templating language to insert data that's passed by the trigger's context. Here's what the context can offer:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),"event #the event that got fired\n    @vid: int - Vehicle ID of the vehicle associated with the device\n    @uid: UUID - The Unit ID of the device\n    @tag: string - Additional event information\n    @t:   string - Type of the event\n    @ts:  string - Timestamp from the device\n    @rec: string - Timestamp of when the event was received\n\ntrigger # the trigger\n    created:        date - When the trigger was created\n    last_modified:  date - When was the trigger last modified\n    last_triggered: date - The last time this trigger got executed\n    last_error:     date - When was the last error for this trigger\n    description:    string - A description of the trigger\n    enabled:        boolean - Whether the trigger is enabled or not\n    device:         Device - The device model\n    interval:       duration - How often is the trigger allowed/going to trigger\n\n# nested models\nDevice\n    id:                 uuid - The device id\n    unit_id:            uuid - The device's unit id\n    callName:           string - The name of the device (user provided)\n    vehicle:            Profile - The profile (vehicle) model\n    last_communication: date - The last time this device was connected to the cloud\n\nProfile (the vehicle the device is registered to)\n    type:         string - The type of the vehicle\n    vin:          string - Serial number of the vehicle\n    model:        Model - The model of the vehicle\n    year:         integer - The creation year of the vehicle\n    callName:     string - The name of the vehicle (user provided)\n    licensePlate: string - The license plate of the vehicle\n\nModel\n    make: Make - The make of the model\n    name: string - The name of the model\n\nMake\n    name: string - The name of the make (BMW, Mercedes-Benz, Toyota etc.)\n")),Object(o.b)("p",null,"You can use these values in a payload like the following example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),'{\n    "payload": "{{ trigger[\'description\'] }}",\n    "device_uid": "{{ event[\'@uid\'] }}"\n}\n')),Object(o.b)("p",null,"which will translate into the following payload:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),'{\n    "payload": "Description that you\'ve specified when creating the trigger",\n    "device_uid": "c3cce723-79ed-4897-80cf-4cd48b62b235"\n}\n')),Object(o.b)("p",null,"Keep in mind that some events provide additional data in the ",Object(o.b)("inlineCode",{parentName:"p"},"event")," context, so there will be additional fields available. An example for such a scenario\nis the ",Object(o.b)("inlineCode",{parentName:"p"},"vehicle/battery/discharging")," event which has an ",Object(o.b)("inlineCode",{parentName:"p"},"event.vehicle.battery.level")," value showing a percentage value of the battery."),Object(o.b)("h3",{id:"examples-1"},"Examples"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Send email")),Object(o.b)("p",null,Object(o.b)("img",{alt:"actions_example_1",src:n(231).default})),Object(o.b)("p",null,"Here is how an example email from a trigger looks:"),Object(o.b)("p",null,Object(o.b)("img",{alt:"actions_example_email",src:n(232).default})," "),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Send webhook request")),Object(o.b)("p",null,Object(o.b)("img",{alt:"actions_example_2",src:n(233).default}),"  "),Object(o.b)("p",null,"Address: Your unique Slack webhook address",Object(o.b)("br",{parentName:"p"}),"\n","Payload: "),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),"{\"text\": \"{{ trigger['description'] }} was executed, by device {{ trigger['device']['callName'] }}\"}\n")),Object(o.b)("p",null,"The payload in this case will end up looking something like this when being sent to Slack:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),'{\n    "text": "your_trigger_description_here was executed by device your_device_callName"\n}\n')),Object(o.b)("p",null,"This example also shows how you can get nested model data - for each nested level a new set of square brackets needs to be added with\na string of the field name that you would like to get. In the above example, we query for the device's name through the trigger field."),Object(o.b)("p",null,"You can check out Slack's ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://api.slack.com/incoming-webhooks"}),"documentation")," for more information on what fields they accept."),Object(o.b)("p",null,Object(o.b)("img",{alt:"actions_example_3",src:n(234).default})),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Send MQTT message via webhook (home assistant etc)"),Object(o.b)("br",{parentName:"p"}),"\n","Check out this tutorial: ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://www.home-assistant.io/blog/2017/03/28/http-to-mqtt-bridge/"}),"https://www.home-assistant.io/blog/2017/03/28/http-to-mqtt-bridge/"),Object(o.b)("br",{parentName:"p"}),"\n","Address: heroku app address",Object(o.b)("br",{parentName:"p"}),"\n","Payload: "),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),'{"topic":"<mqtt_topic>","message":"<mqtt_message>","key":"<AUTH_KEY>"}\n')),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Trigger IFTTT applet via webhook"),Object(o.b)("br",{parentName:"p"}),"\n","Address: Find on ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://ifttt.com/services/maker_webhooks/settings"}),"https://ifttt.com/services/maker_webhooks/settings"),Object(o.b)("br",{parentName:"p"}),"\n","Payload: optional and custom based on the IFTTT applet.  "),Object(o.b)("h2",{id:"discussion"},"Discussion"),Object(o.b)("p",null,"If you'd like to discuss this topic with us or other fellow community memebers, you can do so on our community page dedicated\nfor this guide: ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://community.autopi.io/t/a-guide-to-triggers/429"}),"A Guide to Triggers"),"."))}d.isMDXComponent=!0}}]);