<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DB2BZPKYN9"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DB2BZPKYN9",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="AutoPi Documentation" href="/opensearch.xml"><title data-react-helmet="true">Using the CAN bus commands | AutoPi Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://docs.autopi.io/img/favicon-194x194.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.autopi.io/img/favicon-194x194.png"><meta data-react-helmet="true" property="og:url" content="https://docs.autopi.io/guides/obd-ii/using-the-can-bus-commands/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:type" content="website"><meta data-react-helmet="true" property="og:title" content="Using the CAN bus commands | AutoPi Documentation"><meta data-react-helmet="true" name="description" content="Working with the CAN bus is on your own risk. Playback and sending commands to the vehicle can be"><meta data-react-helmet="true" property="og:description" content="Working with the CAN bus is on your own risk. Playback and sending commands to the vehicle can be"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.autopi.io/guides/obd-ii/using-the-can-bus-commands/"><link data-react-helmet="true" rel="alternate" href="https://docs.autopi.io/guides/obd-ii/using-the-can-bus-commands/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.autopi.io/guides/obd-ii/using-the-can-bus-commands/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://7BRH96O31B-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.71bb87a7.css">
<link rel="preload" href="/assets/js/runtime~main.87712b5c.js" as="script">
<link rel="preload" href="/assets/js/main.9829e590.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo_trans_doc.png" alt="AutoPi Documentation Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_trans_doc_dark.png" alt="AutoPi Documentation Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/cloud/cloud-intro/">Cloud</a><a class="navbar__item navbar__link" href="/core/core-intro/">Core</a><a class="navbar__item navbar__link" href="/hardware/hardware-intro/">Hardware</a><a class="navbar__item navbar__link" href="/guides/guides-intro/">Guides</a><a href="https://api.autopi.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/guides/guides-intro/">Getting started</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Business</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">OBD-II</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/obd-ii/obd-ii-intro/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/obd-ii/create-can-signal-loggers/">Create CAN Signal Loggers (Coming Soon)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/obd-ii/create-pid-loggers/">Create PID Loggers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/obd-ii/debug-raw-pid-queries/">Debug Raw PID Queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/obd-ii/how-to-use-the-car-explorer-feature/">How To Use The &quot;Car Explorer&quot; Feature</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/obd-ii/log-raw-can-messages/">Log raw CAN messages</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/guides/obd-ii/using-the-can-bus-commands/">Using the CAN bus commands</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Services</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/4g-internet-setup-troubleshooting/">4G internet setup troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/a-guide-to-triggers/">A guide to Triggers</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/adding-a-new-widget-from-scratch/">Adding a New Widget from Scratch</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/autopi-logs/">AutoPi Logs</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/configuring-mqtt/">Configuring MQTT</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/enabling_bluetooth_on_TMU_devices/">Enabling Bluetooth on Devices With STN Chips</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/how-to-ssh-to-your-device/">How to SSH to your device</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/installing-a-camera-on-your-autopi/">Installing a Camera on Your AutoPi</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/j1939-getting-started-guide/">J1939 Getting Started Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/jumpers/">Jumpers</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/local-development-workflow/">Local Development Workflow</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/power-cycle-for-electric-vehicles/">Power Cycle for Electric Vehicles</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/reflashing-your-device/">Reflashing your device</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/remotely-waking-up-your-device/">Remotely waking up your device</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/rfid-integartion/">RFID Reader Integration</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/setting-up-docker/">Setting up Docker on your device</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/setting-up-our-device-with-verizon-wireless/">Setting up our device with Verizon Wireless</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/upgrading-your-raspberry-pi/">Upgrade/Replace Your Raspberry Pi Computer</a></li><li class="menu__list-item"><a class="menu__link" href="/guides/using-the-autopi-with-an-external-power-supply/">Using the AutoPi with an external power supply</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Using the CAN bus commands</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Working with the CAN bus is on your own risk. Playback and sending commands to the vehicle can be
used to control functions in the vehicle affecting the behavior of the vehicle. We recommend that
you NEVER do testing on a vehicle in motion and that you have the parking brake enabled while you
test.</p></div></div><p>Hello everyone!</p><p>In this guide, we will explore how you can communicate and interact with your vehicle&#x27;s CAN bus.
Typically, there are two types of CAN busses.</p><p>One type responds to requests for data, that is to say, it almost acts like an HTTP server - it
receives a request for a specific data point (let&#x27;s say speed or RPM) and it sends the requested
data back. This type of CAN bus is usually handled with PIDs.</p><p>The second type sends all the vehicle&#x27;s data on the CAN bus. This means that there is going to be
large amounts of data being streamed. We call this type of data CAN Messages. Within those CAN
messages are the so-called CAN signals. Each signal usually represents a specific data point, like
speed or RPM.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="sending-pids"></a>Sending PID&#x27;s<a class="hash-link" href="#sending-pids" title="Direct link to heading">#</a></h2><p>Let&#x27;s start off with the <a href="/core/commands/core-commands-obd/#obdquery"><code>obd.query</code></a> command. This command is
used to query the first type of CAN busses. Let&#x27;s take a look at an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly console"><pre tabindex="0" class="prism-code language-console codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">obd.query test mode=01 pid=0C</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You may need to add the <code>force=True</code> parameter to make sure the ECU in the vehicle accepts the
command. </p></div></div><p>This command can be run from <a href="https:/my.autopi.io" target="_blank" rel="noopener noreferrer">my.autopi.io</a> or
<a href="http://local.auotpi.io" target="_blank" rel="noopener noreferrer">local.autopi.io</a>&#x27;s web consoles. Let&#x27;s try to explain each element of the
command. Firstly, <code>obd.query</code> - that is simply the command that we&#x27;re attempting to execute. Next is
<code>test</code>. This is the name that the PID will use. It makes no difference to the comand&#x27;s execution
what the name is going to be, but if you end up setting up a logger, the name will be used to save
that data on your account, so you can later reference it using the name to create a widget.</p><p>Next, there is the <code>mode=01</code> and <code>pid=0C</code> pieces of the puzzle. These are the specifications of
which data point you&#x27;d like to query for. In this case, we are asking the ECU of the vehicle to
respond with the current RPM. You can see a full list of standard PID&#x27;s
<a href="https://en.wikipedia.org/wiki/OBD-II_PIDs" target="_blank" rel="noopener noreferrer">here</a>. Your vehicle may be able to support more or less
PID&#x27;s than shown on Wikipedia. </p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If you&#x27;d like to run this command directly
from the device (through <a href="/guides/how-to-ssh-to-your-device/">SSH</a> or similar), you will need to
prepend the <code>autopi</code> keyword, like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly console"><pre tabindex="0" class="prism-code language-console codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">autopi obd.query test mode=01 pid=0C</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="the-can-interface"></a>The CAN interface<a class="hash-link" href="#the-can-interface" title="Direct link to heading">#</a></h2><p>The CAN interface is somewhat different than just sending standard PID&#x27;s. It relies more on
parcing the full data stream on the CAN bus. This is far more advanced, but it also opens up to a
whole new level of fun. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="setting-the-protocol"></a>Setting the protocol<a class="hash-link" href="#setting-the-protocol" title="Direct link to heading">#</a></h3><p>The AutoPi is able to support a wide range of protocols. When you insert it into your vehicle it
will try to autodetect the protocol used by the vehicle. It is not always going to be the case that
the same protocol is used for all CAN traffic. In fact, CAN traffic may flow on more than one
protocol in your vehicle. Switching the protocol on the AutoPi makes it listen for traffic on
different electrical pins. You can check the current protocol settings using this command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">obd.protocol</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will give you a list of all the protocols you can set. Changing the protocol can be done with
this command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">obd.protocol set=&lt;num&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Where <code>&lt;num&gt;</code> is the protocol number.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="dumpingreading-data-from-the-can-bus"></a>Dumping/reading data from the CAN bus<a class="hash-link" href="#dumpingreading-data-from-the-can-bus" title="Direct link to heading">#</a></h3><p>The new interface opens up for dumping data from the CAN bus on the protocol selected. This can be
done using the <a href="/core/commands/core-commands-obd/#obddump"><code>obd.dump</code></a> command. Using the command is very easy:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">obd.dump duration=5</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Optional parameters:</p><ul><li><code>duration=&lt;seconds&gt;</code>: How many seconds to record data. Default is <code>2</code> seconds.</li><li><code>file=&lt;path&gt;</code>: Write data to a file instead of displaying it on the screen.</li></ul><p>This will dump a list of messages recorded within 5 seconds of starting the execution of the
command. Those messages might not make much sense at first glance, but that&#x27;s okay. Usually, DBC
files are used to parse those messages into human readable data.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="playback-of-a-recorded-file"></a>Playback of a recorded file<a class="hash-link" href="#playback-of-a-recorded-file" title="Direct link to heading">#</a></h3><p>A file recorded with the <code>obd.dump</code> command can be played/replayed to the vehicle using the
<a href="/core/commands/core-commands-obd/#obdplay"><code>obd.play</code></a> command. Here&#x27;s an example usage:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">obd.play file=&lt;path&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The will playback the entire file on the CAN bus. </p><p>Optional parameters:</p><ul><li><code>slice=&lt;T|B&gt;</code>: Slice the list of messages before sending on the CAN bus. Based one the divide
and conquer algorithm. Multiple slice characters can be specified in continuation of each other.<ul><li><code>T</code>: Top half of remaining result.</li><li><code>B</code>: Bottom half of remaining result.</li></ul></li><li><code>filter=&lt;expression&gt;</code>: Filter out messages before sending on the CAN bus. Multiple filters can
be specified if separated using comma characters.<ul><li><code>+[id][#][data]</code>: Include only messages matching string.</li><li><code>-[id][#][data]</code>: Exclude messages matching string.</li><li><code>+duplicate</code>: Include only messages where duplicates exist.</li><li><code>-duplicate</code>: Exclude messages where duplicates exist.</li><li><code>+mutate</code>: Include only messages where data mutates.</li><li><code>-mutate</code>: Exclude messages where data mutates.</li></ul></li><li><code>group=&lt;id|msg&gt;</code>: How to group the result of sent messages. This only affects the display
values returned from this command. Default is <code>id</code>.</li><li><code>test=&lt;true|false&gt;</code>: Run command in test-only (dry-run) mode. No data will be sent on CAN bus.
Default is <code>false</code>.</li></ul><p>All the filter parameters can be used to find the specific commands that you are seeking. With
filters you can remove data that you know is not relevant for finding your specific command (like
data that appears a lot). With the slice parameter you can use the &quot;divide and conquer&quot; technique
to find the specific command. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="sending-a-single-message"></a>Sending a single message<a class="hash-link" href="#sending-a-single-message" title="Direct link to heading">#</a></h3><p>The <code>obd.dump</code> and the <code>obd.play</code> commands is typically used for finding a single specific
command you want to send to the car. This can be lock/unlock or something else controlling your
vehicle. </p><p>When you have the specific command, you can send it directly using the
<a href="/core/commands/core-commands-obd/#obdsend"><code>obd.send</code></a> command. Here&#x27;s an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">obd.send 2101#280000000003E800 expect_response=True auto_format=True</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The first part before the # is the ECU number (the header) and the last part is the data payload.
You may need to remove the <code>expect_response</code> if the ECU doesn&#x27;t respond on the message you&#x27;ve
send.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="non-obd2-queries"></a>Non-OBD2 queries<a class="hash-link" href="#non-obd2-queries" title="Direct link to heading">#</a></h3><p>Sometimes a vehicle supports non-OBD-2 queries. An example of this is manufacturer proprietary
protocols. When this is the case, you need to enrich the queries with CAN Flow Control parameters.</p><p>Let&#x27;s look at an example of a proprietary query, where the request data is <code>1AA # 02 00 01 00 00 00 00 00</code>,
and the response is <code>2AA # 02 XX XX 00 00 00 00 00</code>, where the <code>XX</code> bytes are the data bytes. For
the sake of having the example complete, let&#x27;s assume that this queries for the speed in kph. If
we try to do this query as we might with any other OBD-2 PID, we won&#x27;t get a response. This is
because the device does not know how the message looks like. This might seem pointless if these
request-response messages are the only traffic on the CAN bus, however, imagine if there are hundreads
of CAN frames being sent on the bus every second. How is the device to know which CAN frame is the
response? We need to specify this manually.  </p><p>If you take a look at the <a href="/core/commands/core-commands-obd/#obdquery">obd.query</a> command, you&#x27;ll notice several
arguments dedicated to can flow control. The 2 relevant ones are <strong><code>can_flow_control_filter</code></strong> and
<strong><code>can_flow_control_id_pair</code></strong>. </p><p><strong><code>can_flow_control_filter</code></strong> - filters out all non-query related can frames from the traffic. Although you
might get an expected response without specifying this parameter, you should still add it. The format for
it is <code>can_flow_control_filter=&lt;Pattern&gt;,&lt;Mask&gt;</code>. In the current example, that would look like this:
<code>can_flow_control_filter=2AA,7FF</code>.</p><p><strong><code>can_flow_control_id_pair</code></strong> - pairs the query request header (Transmitter ID) to the response header (Receiver ID)
in format <code>can_flow_control_id_pair=&lt;Transmitter ID&gt;,&lt;Receiver ID&gt;</code>. In this example, it would be: <code>can_flow_control_id_pair=1AA,2AA</code>.</p><p>All this taken into account, the command would look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ obd.query PROPRIETARY_SPEED header=1AA mode=00 pid=01 can_flow_control_filter=2AA,7FF can_flow_control_id_pair=1AA,2AA force=True</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_stamp: &#x27;2023-08-28T12:22:31.253543&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_type: proprietary_speed</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">value: 2aa0200430000000000</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Next, we&#x27;ll need to extract the speed data with a formula. In this case, all the data bytes correspond to
the data we&#x27;re looking for, so we can use the simple formula of <code>bytes_to_int(message.data)</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ obd.query PROPRIETARY_SPEED header=1AA mode=00 pid=01 can_flow_control_filter=2AA,7FF can_flow_control_id_pair=1AA,2AA force=True formula=&#x27;bytes_to_int(message.data)&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_stamp: &#x27;2023-08-28T12:22:35.052518&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_type: proprietary_speed</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">value: 67</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>There are a few quirks to keep in mind when working with these and with CAN bus in general:</p><ul><li>As long as the vehicle&#x27;s bus is autodetected, the <code>obd.query</code> command will try to verify that the
protocol is still valid by sending a known valid OBD-2 message onto the bus and waiting for a reply. If
the vehicle does not support standard OBD-2, this will cause the command to fail. To prevent this, either
ensure the vehicle supports OBD-2, or create a new bus, which does not have the &#x27;autodetected&#x27; flag.</li><li>The selected protocol&#x27;s header length must match the header length of the sent/received messages. For
example, you can not specify <code>protocol=7</code>, which has a 29-bit header length, and then query for an 11-bit
message. You will not get the expected result. Keep in mind that there will always be a protocol selected,
even when one is not specified in the command. When the command is being run through the logger, this will
be the <code>default</code> protocol.</li></ul></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>For those closely familiar with CAN flow control, it might seem confusing that these parameters have
the can_flow_control_ prefix, as CAN flow control usually refers to multi-frame messages. The naming is
related to how older versions of the AutoPi communicated on the CAN bus.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="using-the-cloud-can-analyzer"></a>Using the Cloud CAN Analyzer<a class="hash-link" href="#using-the-cloud-can-analyzer" title="Direct link to heading">#</a></h2><p>All the above commands are how the interface to the vehicle works. We have combined all of this in
an interactive CAN Analyzer, which is accessible from the AutoPi Cloud in
Car Explorer &gt; CAN Analyzer. If you don&#x27;t see that menu link, you need to make sure that you&#x27;ve
installed the CAN Analyzer add-on from the Add-ons page.</p><p>The CAN Analyzer makes working with your car much simpler. To find your specific command follow
these steps:</p><ol><li><p>Configure your CAN Bus interface. On the account page under &quot;Vehicles&quot; you can autodetect the
most common CAN Bus. If you need to work with a special CAN bus, make sure you have the right baud
rate configured.</p></li><li><p>Select the Bus you want to use and press record. The device will make a &quot;beep&quot; sound when the
recording begins and another one when the recording ends. Make sure that the CAN command you want
to record is happening between the two sounds (like door unlock or window control).</p></li><li><p>The recording is now stored on the device and you can play it back immediately using the CAN
player on the right-hand side of the screen.</p></li><li><p>You will see that a lot of data is returned from the bus, so to find the specific command for
your function, we recommend using the filters on the right-hand side. Typically, a lot of the data
is repetetive, so you can start out by removing all the duplicates.</p></li><li><p>With the filters, narrow down the results to as few as possible. Then you can replay the
commands one by one and see if you can find the command controlling the function you are looking
for.</p></li><li><p>When you have found your command you can always resend it by using the <code>obd.send</code> command
described above.</p></li></ol><h2>Discussion</h2><p>If you&#x27;d like to discuss this topic with us or other fellow community members, you can do so on our community page dedicated for this guide: <a href="https://community.autopi.io/t/using-the-can-bus-commands/571">Using the CAN bus commands</a>.</p><p>You can also write us an email on <a href="mailto:support@autopi.io">support@autopi.io</a>. We usually respond back in 24 hours on working days.</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/autopi-io/documentation/edit/master/docs/guides/obd-ii/using_the_can_bus_commands.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/guides/obd-ii/log-raw-can-messages/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Log raw CAN messages</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/guides/services/services-intro/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sending-pids" class="table-of-contents__link">Sending PID&#39;s</a></li><li><a href="#the-can-interface" class="table-of-contents__link">The CAN interface</a><ul><li><a href="#setting-the-protocol" class="table-of-contents__link">Setting the protocol</a></li><li><a href="#dumpingreading-data-from-the-can-bus" class="table-of-contents__link">Dumping/reading data from the CAN bus</a></li><li><a href="#playback-of-a-recorded-file" class="table-of-contents__link">Playback of a recorded file</a></li><li><a href="#sending-a-single-message" class="table-of-contents__link">Sending a single message</a></li><li><a href="#non-obd2-queries" class="table-of-contents__link">Non-OBD2 queries</a></li></ul></li><li><a href="#using-the-cloud-can-analyzer" class="table-of-contents__link">Using the Cloud CAN Analyzer</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">AutoPi.io</div><ul class="footer__items"><li class="footer__item"><a href="https://www.autopi.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">AutoPi.io</a></li><li class="footer__item"><a href="https://my.autopi.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">My AutoPi Cloud</a></li><li class="footer__item"><a href="https://shop.autopi.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Shop</a></li><li class="footer__item"><a href="https://docs.autopi.io/search/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Search Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://community.autopi.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>AutoPi Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/autopi-io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub - AutoPi Core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://www.reddit.com/r/autopi/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/autopi_io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.facebook.com/autopi.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/autopi.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCH50VR17emPVVfnIWlGMLig" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 AutoPi.io.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.87712b5c.js"></script>
<script src="/assets/js/main.9829e590.js"></script>
</body>
</html>