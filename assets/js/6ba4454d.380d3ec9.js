"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[8085],{5241:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"developer_guides/accessing-raw-gps-data","title":"Accessing Raw GPS Data (10 Hz)","description":"---","source":"@site/docs/developer_guides/accessing_raw_gps.md","sourceDirName":"developer_guides","slug":"/developer_guides/accessing-raw-gps-data","permalink":"/developer_guides/accessing-raw-gps-data","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/developer_guides/accessing_raw_gps.md","tags":[],"version":"current","frontMatter":{"id":"accessing-raw-gps-data","title":"Accessing Raw GPS Data (10 Hz)","supportedDevices":["cm4","pro","pro_case"]},"sidebar":"sidebar","previous":{"title":"Using the AutoPi With an External Power Supply","permalink":"/developer_guides/using-the-autopi-with-an-external-power-supply"},"next":{"title":"Introduction","permalink":"/cloud/"}}');var r=t(74848),s=t(28453),a=(t(58162),t(47886));const o={id:"accessing-raw-gps-data",title:"Accessing Raw GPS Data (10 Hz)",supportedDevices:["cm4","pro","pro_case"]},d=void 0,l={},c=[{value:"Overview",id:"overview",level:2},{value:"Steps",id:"steps",level:2},{value:"1. Disable the GNSS Manager Service",id:"1-disable-the-gnss-manager-service",level:3},{value:"2. Configure and Start the GPS Data Stream",id:"2-configure-and-start-the-gps-data-stream",level:3},{value:"3. Verify Data Stream",id:"3-verify-data-stream",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"GPS Port Not Found",id:"gps-port-not-found",level:3},{value:"Permission Denied",id:"permission-denied",level:3},{value:"No Data Received",id:"no-data-received",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.A,{supported:o.supportedDevices}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"This guide explains how to enable and stream raw GPS (NMEA) data at 10 Hz from your AutoPi device."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["By default, the device\u2019s ",(0,r.jsx)(n.code,{children:"GNSS Manager"})," service handles GPS communication. To stream raw NMEA data directly, this service must first be disabled to free up the serial (TTY) port used for GPS communication.\nOnce disabled, you can use a simple Python script mentioned below to configure the GPS polling rate, enable streaming mode, and read data from the serial output in real time."]}),"\n",(0,r.jsx)(n.h2,{id:"steps",children:"Steps"}),"\n",(0,r.jsx)(n.h3,{id:"1-disable-the-gnss-manager-service",children:"1. Disable the GNSS Manager Service"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Navigate to the device you want to configure on ",(0,r.jsx)(n.a,{href:"https://my.autopi.io/#/login",children:"AutoPi's cloud"})]}),"\n",(0,r.jsxs)(n.li,{children:["Go to ",(0,r.jsx)(n.strong,{children:"Services"})," page under Device."]}),"\n",(0,r.jsxs)(n.li,{children:["Locate the ",(0,r.jsx)(n.code,{children:"gnss_manager"}),"service."]}),"\n",(0,r.jsx)(n.li,{children:"Disable the service. Disabling this service ensures that no other process is using the same TTY port needed for raw NMEA streaming."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Disable the gnss manager service",src:t(45653).A+"",width:"1354",height:"512"})}),"\n",(0,r.jsx)(n.h3,{id:"2-configure-and-start-the-gps-data-stream",children:"2. Configure and Start the GPS Data Stream"}),"\n",(0,r.jsx)(n.p,{children:"Use the provided Python script to set up the GPS polling rate and start the NMEA data stream."}),"\n",(0,r.jsx)(n.p,{children:"This example script:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configures the GPS to output data at 10 Hz"}),"\n",(0,r.jsx)(n.li,{children:"Enables continuous streaming mode"}),"\n",(0,r.jsx)(n.li,{children:"Prints raw NMEA sentences to stdout"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"You can modify the script to log data to a file, filter specific NMEA messages, or integrate with your application."})}),"\n",(0,r.jsxs)(n.p,{children:["You can copy the ",(0,r.jsx)(n.strong,{children:"example Python script"})," below:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'#!/bin/python3\n\nimport serial\nimport time\nimport threading\n\nPORT_GPS = "/dev/ttyTLT02"\nPORT_MODEM = "/dev/ttyTLT01"\nBAUD = 115200\nstop_flag = False\n\n\ndef key_listener():\n    global stop_flag\n    key = str(input())\n    print("you pressed {}".format(key))\n    stop_flag=True\n\n\n\n\ndef setup_gps():\n    with serial.Serial(PORT_GPS, BAUD, timeout=1) as modem:\n        modem.reset_input_buffer()\n        modem.reset_output_buffer()\n        modem.write(b\'AT$GPSNHZ?\\r\')\n        time.sleep(0.5)\n        response = modem.read_all().decode(errors="ignore")\n        if not "3" in response:\n            modem.write(b\'AT$GPSP=0\\r\')\n            time.sleep(5)\n            modem.write(b\'AT$GPSNHZ=3\\r\')\n            time.sleep(5)\n            modem.write(b\'AT$GPSP=1\\r\')\n            time.sleep(5)\n        # open port!\n        modem.write(b\'AT$GPSNMUN=2,1,0,0,0,0,0\\r\')\n        time.sleep(5)\n\n\ndef stop_streaming():\n    with serial.Serial(PORT_GPS, BAUD, timeout=1) as modem:\n        modem.reset_input_buffer()\n        modem.reset_output_buffer()\n        modem.write(b\'AT$GPSNMUN=0\\r\')\n        time.sleep(0.5)\n        return modem.read_all().decode(errors="ignore")\n\n    \n\ndef run():\n    global stop_flag\n    consecutive_errors = 0\n    while not stop_flag:\n        try:\n            setup_gps()\n            with serial.Serial(PORT_GPS, BAUD, timeout=0.1) as ser:\n                print("Listening for NMEA...")\n                while not stop_flag:\n                    try:\n                        line = ser.readline().decode(errors="ignore").strip()\n                        if not line:\n                            consecutive_errors += 1\n                            if consecutive_errors > 10:\n                                print("Too many consecutive errors, assuming disconnect.")\n                                break\n                            continue\n\n                        consecutive_errors = 0\n                        if line.startswith("$"):\n                            print(line)\n                        if stop_flag:\n                            print("EXITING NOW!!!")\n\n                    except serial.SerialException as e:\n                        consecutive_errors += 1\n                        print("Serial error: {}".format(e))\n                    except Exception as e:\n                        print("Unexpected error: {}".format(e))\n        except serial.SerialException as e:\n            consecutive_errors += 1\n            print("Could not open serial port {}: {}".format(PORT_GPS, e))\n        except Exception as e:\n            print("General error: {}".format(e))\n    res = stop_streaming()\n    print("stopped streaming with res: {}".format(res))\n\n\n\nif __name__ == "__main__":\n    n=threading.Thread(target=key_listener).start()\n    i=threading.Thread(target=run).start()\n\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-verify-data-stream",children:"3. Verify Data Stream"}),"\n",(0,r.jsx)(n.p,{children:"When the script runs successfully, you\u2019ll see a continuous stream of raw NMEA sentences, for example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$GPGGA,120000.00,5540.1234,N,01234.5678,E,1,12,0.8,15.0,M,40.0,M,,*5C\n$GPRMC,120000.00,A,5540.1234,N,01234.5678,E,0.13,240.15,060625,,,A*6D\n"})}),"\n",(0,r.jsx)(n.p,{children:"These sentences contain the raw GPS position, velocity, and time data updated at 10 Hz."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.p,{children:"While configuring your AutoPi device to be able to stream GPS data at 10 Hz, some issues may arise and therefore we are mentioning the most common issues and ways to solve them."}),"\n",(0,r.jsx)(n.h3,{id:"gps-port-not-found",children:"GPS Port Not Found"}),"\n",(0,r.jsx)(n.p,{children:"If you receive an error such as:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"serial.serialutil.SerialException: [Errno 2] No such file or directory: '/dev/ttyUSB0'\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Run dmesg | grep tty on the device to list available serial ports."}),"\n",(0,r.jsx)(n.li,{children:"The GPS may appear as /dev/ttyS4, /dev/ttyACM0, or /dev/ttyUSB1 depending on your setup."}),"\n",(0,r.jsx)(n.li,{children:"Update the tty_device variable in the script accordingly."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"permission-denied",children:"Permission Denied"}),"\n",(0,r.jsx)(n.p,{children:"If you see a permission error when opening the serial port:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"PermissionError: [Errno 13] Permission denied: '/dev/ttyS4'\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Run the script as root or add your user to the dialout group:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo usermod -a -G dialout $USER\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then log out and back in."}),"\n",(0,r.jsx)(n.h3,{id:"no-data-received",children:"No Data Received"}),"\n",(0,r.jsx)(n.p,{children:"If the script runs but no NMEA data is printed:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Confirm that the ",(0,r.jsx)(n.code,{children:"gnss_manager"})," service is disabled."]}),"\n",(0,r.jsx)(n.li,{children:"Check that your GPS module has a valid satellite fix (usually indicated by an LED or diagnostic message)."}),"\n",(0,r.jsx)(n.li,{children:"Try reducing the baud rate (e.g., 9600) if unsure of the GPS module\u2019s settings."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(96540);const r={},s=i.createContext(r);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}},45653:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/services_gnss_manager-b40505e37b714bf531e6a2c4931ae882.png"},47886:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var i=t(74848);const r={mini:{name:"Mini",image:"/img/hardware/autopi_mini/AutoPi_Mini_5_Top_right.png"},cm4:{name:"TMU CM4",image:"/img/hardware/shared_devices/autopi_cm4_device_look.webp"},pro:{name:"CAN-FD Pro",image:"/img/hardware/autopi_canfd_pro/canfd_pro_trans.png"},pro_case:{name:"CAN-FD Pro +IP67 casing",image:"/img/hardware/shared_devices/autopi_canfd_pro_casing_obdcable.png"}};function s(e){let{supported:n}=e;return n?.length?(0,i.jsxs)("div",{style:{padding:"1rem",marginBottom:"1.5rem"},children:[(0,i.jsx)("strong",{children:"This guide is applicable to the following device / devices:"}),(0,i.jsx)("div",{style:{display:"flex",gap:"1.5rem",marginTop:"0.75rem"},children:n.map((e=>{const n=r[e];return(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("img",{src:n.image,alt:n.name,style:{height:"60px",marginBottom:"0.5rem",display:"block",marginLeft:"auto",marginRight:"auto"}}),(0,i.jsx)("div",{children:n.name})]},e)}))})]}):null}},58162:(e,n,t)=>{t.d(n,{A:()=>a});t(96540);const i="homeGrid_MM9h",r="cardGrid_IPp8";var s=t(74848);const a=e=>{let{children:n,home:t=!1}=e;return(0,s.jsx)("div",{className:t?i:r,children:n})}}}]);