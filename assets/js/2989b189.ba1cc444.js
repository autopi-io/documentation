(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[4021],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return d},kt:function(){return m}});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=l(a),m=o,u=c["".concat(p,".").concat(m)]||c[m]||h[m]||i;return a?n.createElement(u,r(r({ref:t},d),{},{components:a})):n.createElement(u,r({ref:t},d))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=c;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var l=2;l<i;l++)r[l]=a[l];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},40876:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return p},metadata:function(){return l},toc:function(){return d},default:function(){return c}});var n=a(22122),o=a(19756),i=(a(67294),a(3905)),r=["components"],s={id:"using-the-can-bus-commands",title:"Using the CAN Bus Commands"},p=void 0,l={unversionedId:"cloud/obd-ii/using-the-can-bus-commands",id:"cloud/obd-ii/using-the-can-bus-commands",isDocsHomePage:!1,title:"Using the CAN Bus Commands",description:"Working with the CAN bus is on your own risk. Playback and sending commands to the vehicle can be",source:"@site/docs/cloud/obd-ii/using_the_can_bus_commands.mdx",sourceDirName:"cloud/obd-ii",slug:"/cloud/obd-ii/using-the-can-bus-commands",permalink:"/cloud/obd-ii/using-the-can-bus-commands",editUrl:"https://github.com/autopi-io/documentation/edit/master/docs/cloud/obd-ii/using_the_can_bus_commands.mdx",tags:[],version:"current",frontMatter:{id:"using-the-can-bus-commands",title:"Using the CAN Bus Commands"},sidebar:"sidebar",previous:{title:"Log Raw CAN Messages",permalink:"/cloud/obd-ii/log-raw-can-messages"},next:{title:"Automatic OBD Logger Pausing",permalink:"/cloud/obd-ii/automatic-obd-logger-pausing"}},d=[{value:"Sending PID&#39;s",id:"sending-pids",children:[]},{value:"The CAN Interface",id:"the-can-interface",children:[{value:"Setting the Protocol",id:"setting-the-protocol",children:[]},{value:"Dumping/Reading Data From the CAN Bus",id:"dumpingreading-data-from-the-can-bus",children:[]},{value:"Playback of a Recorded File",id:"playback-of-a-recorded-file",children:[]},{value:"Sending a Single Message",id:"sending-a-single-message",children:[]},{value:"Non-OBD2 Queries",id:"non-obd2-queries",children:[]}]},{value:"Using the Cloud CAN Analyzer",id:"using-the-cloud-can-analyzer",children:[]}],h={toc:d};function c(e){var t=e.components,a=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Working with the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus is on your own risk. Playback and sending commands to the vehicle can be\nused to control functions in the vehicle affecting the behavior of the vehicle. We recommend that\nyou NEVER do testing on a vehicle in motion and that you have the parking brake enabled while you\ntest."))),(0,i.kt)("p",null,"Hello everyone!"),(0,i.kt)("p",null,"In this guide, we will explore how you can communicate and interact with your vehicle's ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus.\nTypically, there are two types of ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," busses."),(0,i.kt)("p",null,"One type responds to requests for data, that is to say, it almost acts like an HTTP server - it\nreceives a request for a specific data point (let's say speed or RPM) and it sends the requested\ndata back. This type of ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus is usually handled with PIDs."),(0,i.kt)("p",null,"The second type sends all the vehicle's data on the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus. This means that there is going to be\nlarge amounts of data being streamed. We call this type of data ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Messages. Within those ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN"),"\nmessages are the so-called ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signals. Each signal usually represents a specific data point, like\nspeed or RPM."),(0,i.kt)("h2",{id:"sending-pids"},"Sending PID's"),(0,i.kt)("p",null,"Let's start off with the ",(0,i.kt)("a",{parentName:"p",href:"/core/commands/core-commands-obd/#obdquery"},(0,i.kt)("inlineCode",{parentName:"a"},"obd.query"))," command. This command is\nused to query the first type of ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," busses. Let's take a look at an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"obd.query test mode=01 pid=0C\n")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You may need to add the ",(0,i.kt)("inlineCode",{parentName:"p"},"force=True")," parameter to make sure the ECU in the vehicle accepts the\ncommand. "))),(0,i.kt)("p",null,"This command can be run from ",(0,i.kt)("a",{parentName:"p",href:"https:/my.autopi.io"},"my.autopi.io")," or\n",(0,i.kt)("a",{parentName:"p",href:"http://local.auotpi.io"},"local.autopi.io"),"'s web consoles. Let's try to explain each element of the\ncommand. Firstly, ",(0,i.kt)("inlineCode",{parentName:"p"},"obd.query")," - that is simply the command that we're attempting to execute. Next is\n",(0,i.kt)("inlineCode",{parentName:"p"},"test"),". This is the name that the PID will use. It makes no difference to the comand's execution\nwhat the name is going to be, but if you end up setting up a logger, the name will be used to save\nthat data on your account, so you can later reference it using the name to create a widget."),(0,i.kt)("p",null,"Next, there is the ",(0,i.kt)("inlineCode",{parentName:"p"},"mode=01")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"pid=0C")," pieces of the puzzle. These are the specifications of\nwhich data point you'd like to query for. In this case, we are asking the ECU of the vehicle to\nrespond with the current RPM. You can see a full list of standard PID's\n",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/OBD-II_PIDs"},"here"),". Your vehicle may be able to support more or less\nPID's than shown on Wikipedia. "),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you'd like to run this command directly\nfrom the device (through ",(0,i.kt)("a",{parentName:"p",href:"/developer_guides/how-to-ssh-to-your-device"},"SSH")," or similar), you will need to\nprepend the ",(0,i.kt)("inlineCode",{parentName:"p"},"autopi")," keyword, like so:"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-console"},"autopi obd.query test mode=01 pid=0C\n")))),(0,i.kt)("h2",{id:"the-can-interface"},"The ",(0,i.kt)("a",{parentName:"h2",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Interface"),(0,i.kt)("p",null,"The CAN interface is somewhat different than just sending standard PID's. It relies more on\nparcing the full data stream on the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus. This is far more advanced, but it also opens up to a\nwhole new level of fun. "),(0,i.kt)("h3",{id:"setting-the-protocol"},"Setting the Protocol"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," is able to support a wide range of protocols. When you insert it into your vehicle it\nwill try to autodetect the protocol used by the vehicle. It is not always going to be the case that\nthe same protocol is used for all ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," traffic. In fact, ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," traffic may flow on more than one\nprotocol in your vehicle. Switching the protocol on the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," makes it listen for traffic on\ndifferent electrical pins. You can check the current protocol settings using this command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"obd.protocol\n")),(0,i.kt)("p",null,"This will give you a list of all the protocols you can set. Changing the protocol can be done with\nthis command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"obd.protocol set=<num>\n")),(0,i.kt)("p",null,"Where ",(0,i.kt)("inlineCode",{parentName:"p"},"<num>")," is the protocol number."),(0,i.kt)("h3",{id:"dumpingreading-data-from-the-can-bus"},"Dumping/Reading Data From the ",(0,i.kt)("a",{parentName:"h3",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Bus"),(0,i.kt)("p",null,"The new interface opens up for dumping data from the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus on the protocol selected. This can be\ndone using the ",(0,i.kt)("a",{parentName:"p",href:"/core/commands/core-commands-obd/#obddump"},(0,i.kt)("inlineCode",{parentName:"a"},"obd.dump"))," command. Using the command is very easy:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"obd.dump duration=5\n")),(0,i.kt)("p",null,"Optional parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duration=<seconds>"),": How many seconds to record data. Default is ",(0,i.kt)("inlineCode",{parentName:"li"},"2")," seconds."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"file=<path>"),": Write data to a file instead of displaying it on the screen.")),(0,i.kt)("p",null,"This will dump a list of messages recorded within 5 seconds of starting the execution of the\ncommand. Those messages might not make much sense at first glance, but that's okay. Usually, DBC\nfiles are used to parse those messages into human readable data."),(0,i.kt)("h3",{id:"playback-of-a-recorded-file"},"Playback of a Recorded File"),(0,i.kt)("p",null,"A file recorded with the ",(0,i.kt)("inlineCode",{parentName:"p"},"obd.dump")," command can be played/replayed to the vehicle using the\n",(0,i.kt)("a",{parentName:"p",href:"/core/commands/core-commands-obd/#obdplay"},(0,i.kt)("inlineCode",{parentName:"a"},"obd.play"))," command. Here's an example usage:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"obd.play file=<path>\n")),(0,i.kt)("p",null,"The will playback the entire file on the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus. "),(0,i.kt)("p",null,"Optional parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"slice=<T|B>"),": Slice the list of messages before sending on the ",(0,i.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus. Based one the divide\nand conquer algorithm. Multiple slice characters can be specified in continuation of each other.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"T"),": Top half of remaining result."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"B"),": Bottom half of remaining result."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"filter=<expression>"),": Filter out messages before sending on the ",(0,i.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus. Multiple filters can\nbe specified if separated using comma characters.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+[id][#][data]"),": Include only messages matching string."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-[id][#][data]"),": Exclude messages matching string."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+duplicate"),": Include only messages where duplicates exist."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-duplicate"),": Exclude messages where duplicates exist."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+mutate"),": Include only messages where data mutates."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-mutate"),": Exclude messages where data mutates."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"group=<id|msg>"),": How to group the result of sent messages. This only affects the display\nvalues returned from this command. Default is ",(0,i.kt)("inlineCode",{parentName:"li"},"id"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"test=<true|false>"),": Run command in test-only (dry-run) mode. No data will be sent on ",(0,i.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus.\nDefault is ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),".")),(0,i.kt)("p",null,'All the filter parameters can be used to find the specific commands that you are seeking. With\nfilters you can remove data that you know is not relevant for finding your specific command (like\ndata that appears a lot). With the slice parameter you can use the "divide and conquer" technique\nto find the specific command. '),(0,i.kt)("h3",{id:"sending-a-single-message"},"Sending a Single Message"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"obd.dump")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"obd.play")," commands is typically used for finding a single specific\ncommand you want to send to the car. This can be lock/unlock or something else controlling your\nvehicle. "),(0,i.kt)("p",null,"When you have the specific command, you can send it directly using the\n",(0,i.kt)("a",{parentName:"p",href:"/core/commands/core-commands-obd/#obdsend"},(0,i.kt)("inlineCode",{parentName:"a"},"obd.send"))," command. Here's an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"obd.send 2101#280000000003E800 expect_response=True auto_format=True\n")),(0,i.kt)("p",null,"The first part before the # is the ECU number (the header) and the last part is the data payload.\nYou may need to remove the ",(0,i.kt)("inlineCode",{parentName:"p"},"expect_response")," if the ECU doesn't respond on the message you've\nsend."),(0,i.kt)("h3",{id:"non-obd2-queries"},"Non-OBD2 Queries"),(0,i.kt)("p",null,"Sometimes a vehicle supports non-OBD-2 queries. An example of this is manufacturer proprietary\nprotocols. When this is the case, you need to enrich the queries with ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Flow Control parameters."),(0,i.kt)("p",null,"Let's look at an example of a proprietary query, where the request data is ",(0,i.kt)("inlineCode",{parentName:"p"},"1AA # 02 00 01 00 00 00 00 00"),",\nand the response is ",(0,i.kt)("inlineCode",{parentName:"p"},"2AA # 02 XX XX 00 00 00 00 00"),", where the ",(0,i.kt)("inlineCode",{parentName:"p"},"XX")," bytes are the data bytes. For\nthe sake of having the example complete, let's assume that this queries for the speed in kph. If\nwe try to do this query as we might with any other OBD-2 PID, we won't get a response. This is\nbecause the device does not know how the message looks like. This might seem pointless if these\nrequest-response messages are the only traffic on the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus, however, imagine if there are hundreads\nof ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," frames being sent on the bus every second. How is the device to know which ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," frame is the\nresponse? We need to specify this manually.  "),(0,i.kt)("p",null,"If you take a look at the ",(0,i.kt)("a",{parentName:"p",href:"/core/commands/core-commands-obd#obdquery"},"obd.query")," command, you'll notice several\narguments dedicated to can flow control. The 2 relevant ones are ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"can_flow_control_filter"))," and\n",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"can_flow_control_id_pair")),". "),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"can_flow_control_filter"))," - filters out all non-query related can frames from the traffic. Although you\nmight get an expected response without specifying this parameter, you should still add it. The format for\nit is ",(0,i.kt)("inlineCode",{parentName:"p"},"can_flow_control_filter=<Pattern>,<Mask>"),". In the current example, that would look like this:\n",(0,i.kt)("inlineCode",{parentName:"p"},"can_flow_control_filter=2AA,7FF"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"can_flow_control_id_pair"))," - pairs the query request header (Transmitter ID) to the response header (Receiver ID)\nin format ",(0,i.kt)("inlineCode",{parentName:"p"},"can_flow_control_id_pair=<Transmitter ID>,<Receiver ID>"),". In this example, it would be: ",(0,i.kt)("inlineCode",{parentName:"p"},"can_flow_control_id_pair=1AA,2AA"),"."),(0,i.kt)("p",null,"All this taken into account, the command would look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ obd.query PROPRIETARY_SPEED header=1AA mode=00 pid=01 can_flow_control_filter=2AA,7FF can_flow_control_id_pair=1AA,2AA force=True\n_stamp: '2023-08-28T12:22:31.253543'\n_type: proprietary_speed\nvalue: 2aa0200430000000000\n")),(0,i.kt)("p",null,"Next, we'll need to extract the speed data with a formula. In this case, all the data bytes correspond to\nthe data we're looking for, so we can use the simple formula of ",(0,i.kt)("inlineCode",{parentName:"p"},"bytes_to_int(message.data)"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ obd.query PROPRIETARY_SPEED header=1AA mode=00 pid=01 can_flow_control_filter=2AA,7FF can_flow_control_id_pair=1AA,2AA force=True formula='bytes_to_int(message.data)'\n_stamp: '2023-08-28T12:22:35.052518'\n_type: proprietary_speed\nvalue: 67\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"There are a few quirks to keep in mind when working with these and with ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus in general:"),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"As long as the vehicle's bus is autodetected, the ",(0,i.kt)("inlineCode",{parentName:"li"},"obd.query")," command will try to verify that the\nprotocol is still valid by sending a known valid OBD-2 message onto the bus and waiting for a reply. If\nthe vehicle does not support standard OBD-2, this will cause the command to fail. To prevent this, either\nensure the vehicle supports OBD-2, or create a new bus, which does not have the 'autodetected' flag."),(0,i.kt)("li",{parentName:"ul"},"The selected protocol's header length must match the header length of the sent/received messages. For\nexample, you can not specify ",(0,i.kt)("inlineCode",{parentName:"li"},"protocol=7"),", which has a 29-bit header length, and then query for an 11-bit\nmessage. You will not get the expected result. Keep in mind that there will always be a protocol selected,\neven when one is not specified in the command. When the command is being run through the logger, this will\nbe the ",(0,i.kt)("inlineCode",{parentName:"li"},"default")," protocol.")))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"For those closely familiar with ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," flow control, it might seem confusing that these parameters have\nthe can","_","flow","_","control","_"," prefix, as ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," flow control usually refers to multi-frame messages. The naming is\nrelated to how older versions of the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," communicated on the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus."))),(0,i.kt)("h2",{id:"using-the-cloud-can-analyzer"},"Using the ",(0,i.kt)("a",{parentName:"h2",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud")," ",(0,i.kt)("a",{parentName:"h2",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Analyzer"),(0,i.kt)("p",null,"All the above commands are how the interface to the vehicle works. We have combined all of this in\nan interactive ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Analyzer, which is accessible from the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud")," in\nDevice > ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Analyzer. If you don't see that menu link, you need to make sure that you've\ninstalled the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Analyzer add-on from the Add-ons page."),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Analyzer makes working with your car much simpler. To find your specific command follow\nthese steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Configure your ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN"),' Bus interface. On the account page under "Vehicles" you can autodetect the\nmost common ',(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Bus. If you need to work with a special ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus, make sure you have the right baud\nrate configured.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'Select the Bus you want to use and press record. The device will make a "beep" sound when the\nrecording begins and another one when the recording ends. Make sure that the ',(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," command you want\nto record is happening between the two sounds (like door unlock or window control).")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The recording is now stored on the device and you can play it back immediately using the ",(0,i.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN"),"\nplayer on the right-hand side of the screen.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"You will see that a lot of data is returned from the bus, so to find the specific command for\nyour function, we recommend using the filters on the right-hand side. Typically, a lot of the data\nis repetetive, so you can start out by removing all the duplicates.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"With the filters, narrow down the results to as few as possible. Then you can replay the\ncommands one by one and see if you can find the command controlling the function you are looking\nfor.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"When you have found your command you can always resend it by using the ",(0,i.kt)("inlineCode",{parentName:"p"},"obd.send")," command\ndescribed above."))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"In case you have any questions, don't hesitate to contact us at ",(0,i.kt)("a",{parentName:"p",href:"mailto:support@autopi.io"},"support@autopi.io"),"."))))}c.isMDXComponent=!0}}]);