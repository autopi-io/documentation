"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[5731],{11396:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"cloud/device_management/software-updates","title":"Software Updates","description":"---","source":"@site/docs/cloud/device_management/software-updates.md","sourceDirName":"cloud/device_management","slug":"/cloud/device_management/software-updates","permalink":"/cloud/device_management/software-updates","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/cloud/device_management/software-updates.md","tags":[],"version":"current","frontMatter":{"id":"software-updates","title":"Software Updates","supportedDevices":["mini","cm4","pro","pro_case"]},"sidebar":"sidebar","previous":{"title":"A Guide to Triggers","permalink":"/cloud/device_management/triggers/a-guide-to-triggers"},"next":{"title":"Geofences","permalink":"/cloud/device_management/geofences"}}');var i=n(74848),s=n(28453),r=(n(58162),n(47886));const o={id:"software-updates",title:"Software Updates",supportedDevices:["mini","cm4","pro","pro_case"]},d=void 0,h={},c=[{value:"Updating Your Device",id:"updating-your-device",level:2},{value:"Update Through the Cloud",id:"update-through-the-cloud",level:3},{value:"Update With a Command",id:"update-with-a-command",level:3},{value:"Check if Your Device is Already Performing an Update",id:"check-if-your-device-is-already-performing-an-update",level:3},{value:"Events",id:"events",level:4},{value:"Running <code>saltutil.running</code>",id:"running-saltutilrunning",level:4},{value:"Viewing Update Attempts",id:"viewing-update-attempts",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.A,{supported:o.supportedDevices}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.p,{children:"In this section, we'll first review how you can update your device and then will move on to reviewing\nyour device's update attempts."}),"\n",(0,i.jsx)(t.h2,{id:"updating-your-device",children:"Updating Your Device"}),"\n",(0,i.jsx)(t.p,{children:"You can update your device in two main ways:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Update through the ",(0,i.jsx)(t.a,{href:"https://www.autopi.io/software-platform/cloud-management",children:"Cloud"})]}),"\n",(0,i.jsx)(t.li,{children:"Update with a command"}),"\n"]}),"\n",(0,i.jsxs)(t.h3,{id:"update-through-the-cloud",children:["Update Through the ",(0,i.jsx)(t.a,{href:"https://www.autopi.io/software-platform/cloud-management",children:"Cloud"})]}),"\n",(0,i.jsxs)(t.p,{children:["This is the method used most often to update a device, as it allows the rest of the system to interact\nwith the device nicely. To update the device, we will first navigate over to the Software Updates page\nof the Cloud (",(0,i.jsx)(t.a,{href:"https://my.autopi.io",children:"my.autopi.io"}),"). There you'll see a page similar to the screenshot\nbelow."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"software-updates-page",src:n(15101).A+"",width:"1616",height:"744"})}),"\n",(0,i.jsx)(t.p,{children:"On the right-hand side, at the top of the page, there is the 'Queue Update' button. If your device\ndoesn't have automatic updates enabled (which is the default behavior), you'll need to manually\nqueue the update. Once you press the button, an update will be queued and you'll be asked if you\nwant to update the device right now."}),"\n",(0,i.jsx)(t.p,{children:"If you don't update the device right now, the device will try to perform the update before going to\nsleep. Whether or not the update is performed successfully, the device will go to sleep right after,\nbut if the update failed, it will be retried after it wakes up every time until the update goes\nthrough."}),"\n",(0,i.jsxs)(t.p,{children:["In case you ",(0,i.jsx)(t.em,{children:"have"}),' enabled automatic updates for your device, then the device will attempt those\nupdates as soon as they are available based on the setting you\'ve set. That can either be "Before\nsleep" or "At start (or before sleep)".']}),"\n",(0,i.jsx)(t.h3,{id:"update-with-a-command",children:"Update With a Command"}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsx)(t.p,{children:"This option is unfortunately not supported on the AutoPi mini devices."})}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["Be careful with this update procedure. If you're trying to update your device, we recommend that you\nfollow the steps above (Update Through the ",(0,i.jsx)(t.a,{href:"https://www.autopi.io/software-platform/cloud-management",children:"Cloud"}),"), as they are the standard way of updating your\ndevices. However, in certain cases, you might need to manually ask the device to update, which is\nwhy we have this section here."]})}),"\n",(0,i.jsx)(t.p,{children:"To perform a manual update on your device, you can run the command below through the web terminal.\nUsing this method will still show an update attempt on the Software Updates page in case you need\nto review the update afterwards."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"minionutil.update_release force=True\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"Only run this command through the web terminal, not through the device itself. Otherwise, you might\nnot receive the correct update, as the device might not be able to fetch certain files to perform\nthe correct update"})}),"\n",(0,i.jsx)(t.h3,{id:"check-if-your-device-is-already-performing-an-update",children:"Check if Your Device is Already Performing an Update"}),"\n",(0,i.jsx)(t.p,{children:"There are two general ways that you can determine if an update is currently being run on your device:\nusing the events or by running a command."}),"\n",(0,i.jsx)(t.h4,{id:"events",children:"Events"}),"\n",(0,i.jsxs)(t.p,{children:["One of the ways to determine if the device is being updated right now is to check the Events page\nunder Device > Events. Here, we're looking for ",(0,i.jsx)(t.a,{href:"/cloud/device_management/events/cloud-events-system#release-events",children:(0,i.jsx)(t.code,{children:"system/release/*"})}),"\nevents, more specifically the ",(0,i.jsx)(t.code,{children:"system/release/pending"}),", ",(0,i.jsx)(t.code,{children:"system/release/retrying"})," or ",(0,i.jsx)(t.code,{children:"system/release/forcing"}),"\nevents. All of those events signify that the device had started an update attempt. If you see a\n",(0,i.jsx)(t.code,{children:"system/release/failed"}),", ",(0,i.jsx)(t.code,{children:"system/release/updated"})," or an event that means the device ",(0,i.jsx)(t.a,{href:"/cloud/device_management/events/cloud-events-system#power-events",children:"shut down"}),",\nthen the device has likely stopped updating."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"It is also possible to fetch the events from the reactor cache with the following command, directly on the device:"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"reactor.manage context cache\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If this list of events contains the above mentioned ",(0,i.jsx)(t.code,{children:"system/release/pending"}),", that means the device us currently applying the update.\nEither during the ",(0,i.jsx)(t.code,{children:"startup"})," states, or during the ",(0,i.jsx)(t.code,{children:"power.sleep"})," command."]}),"\n",(0,i.jsxs)(t.h4,{id:"running-saltutilrunning",children:["Running ",(0,i.jsx)(t.code,{children:"saltutil.running"})]}),"\n",(0,i.jsxs)(t.p,{children:["With the ",(0,i.jsx)(t.code,{children:"saltutil.running"})," command you can check the jobs the device is currently running. Using this command,\nyou can also determine if your device is currently updating. Here are two general responses you may get:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ saltutil.running\n- fun: state.sls\n  jid: req\n  pid: 1124\n  ret: ''\n  arg:\n    - - startup\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The above response is returned usually when the device has just booted up. It signifies that the\n",(0,i.jsx)(t.code,{children:"startup"})," state is being executed (there is a small startup procedure whenever the device starts up\nand is connected to the server). If you have enqueued an update or your device is setup to try the\nupdate as soon as it starts up, a response like the one above would mean that the update is being\nattempted. Let's take a look at the next possible response:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ saltutil.running\n- jid: '20220610114357378648'\n  pid: 1630\n  _stamp: '2022-06-10T11:43:57.382915'\n  ret: event_result\n  arg:\n    - shutdown\n    - pillar:\n        allow_auto_update: true\n      __kwarg__: true\n  fun: state.sls\n- tgt_type: glob\n  jid: '20220610114357091317'\n  tgt: 629c06b123213bf84126afecd44a0340\n  pid: 1627\n  ret: ''\n  user: 2\n  arg:\n    - __kwarg__: true\n      confirm: true\n  fun: power.sleep\n"})}),"\n",(0,i.jsxs)(t.p,{children:["This one is a bit more complex to look at, but there are a few key things to look at here. The response shows\nus that there are two jobs running - let's start with the second job. That job tells the reader that the device is\ngoing to go to sleep (notice the ",(0,i.jsx)(t.code,{children:"fun: power.sleep"})," line). The ",(0,i.jsx)(t.code,{children:"power.sleep"})," function will put the device\nto sleep, but first, it will execute the ",(0,i.jsx)(t.code,{children:"shutdown"})," state. That ",(0,i.jsx)(t.code,{children:"shutdown"})," state is the first job on the list\nreturned above and it is the one that triggers the update as well. Notice the ",(0,i.jsx)(t.code,{children:"allow_auto_update: true"}),' argument,\nwhich signifies the device is most likely attempting the update right now. This type of response is usually seen\nwhen the device has been "forced" to update or it has been setup to attempt updates right before shutting down.']}),"\n",(0,i.jsx)(t.h2,{id:"viewing-update-attempts",children:"Viewing Update Attempts"}),"\n",(0,i.jsx)(t.p,{children:"You are able to review the update release attempts (aka Update Release Runs). They show the update\nprocedure, which operations (states) have been completed successfully and which haven't. There are\nthree times of operations (states) that you can see in an update release run - successful, changed\nand failed."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"update-release-run",src:n(77370).A+"",width:"1212",height:"285"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Successful states are states that have been executed without error, but have made no changes on\nthe device."}),"\n",(0,i.jsx)(t.li,{children:"Changed states are states that have been executed without error and have made a change on the\ndevice."}),"\n",(0,i.jsx)(t.li,{children:"Failed states are states that have been executed with an error. Those states usually have comments\nto try and explain what has gone wrong."}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},15101:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/software-updates-page-23d96fe521fc59d5d0d255ed3fc5e34b.jpg"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var a=n(96540);const i={},s=a.createContext(i);function r(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:t},e.children)}},47886:(e,t,n)=>{n.d(t,{A:()=>s});n(96540);var a=n(74848);const i={mini:{name:"Mini",image:"/img/hardware/autopi_mini/AutoPi_Mini_5_Top_right.png"},cm4:{name:"TMU CM4",image:"/img/hardware/shared_devices/autopi_cm4_device_look.webp"},pro:{name:"CAN-FD Pro",image:"/img/hardware/autopi_canfd_pro/canfd_pro_trans.png"},pro_case:{name:"CAN-FD Pro +IP67 casing",image:"/img/hardware/shared_devices/autopi_canfd_pro_casing_obdcable.png"}};function s(e){let{supported:t}=e;return t?.length?(0,a.jsxs)("div",{style:{padding:"1rem",marginBottom:"1.5rem"},children:[(0,a.jsx)("strong",{children:"This guide is applicable to the following device / devices:"}),(0,a.jsx)("div",{style:{display:"flex",gap:"1.5rem",marginTop:"0.75rem"},children:t.map((e=>{const t=i[e];return(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("img",{src:t.image,alt:t.name,style:{height:"60px",marginBottom:"0.5rem",display:"block",marginLeft:"auto",marginRight:"auto"}}),(0,a.jsx)("div",{children:t.name})]},e)}))})]}):null}},58162:(e,t,n)=>{n.d(t,{A:()=>r});n(96540);const a="homeGrid_MM9h",i="cardGrid_IPp8";var s=n(74848);const r=e=>{let{children:t,home:n=!1}=e;return(0,s.jsx)("div",{className:n?a:i,children:t})}},77370:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/viewing-update-release-run-31aabeb3b8266a1ea183d2200ea7f164.jpg"}}]);