"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[4963],{24218:(e,o,t)=>{t.d(o,{A:()=>a});const a=t.p+"assets/images/obd_import_worker-a7a1b5e55120f7c38d072c86e7f8bf89.png"},25087:(e,o,t)=>{t.d(o,{A:()=>a});const a=t.p+"assets/images/obd_monitor_worker-3f496518499bfe36794ca5e8e2cff275.png"},28453:(e,o,t)=>{t.d(o,{R:()=>n,x:()=>s});var a=t(96540);const r={},i=a.createContext(r);function n(e){const o=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:n(e.components),a.createElement(i.Provider,{value:o},e.children)}},34781:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>h,contentTitle:()=>d,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"cloud/obd-ii/log-raw-can-messages","title":"Log Raw CAN Messages","description":"---","source":"@site/docs/cloud/obd-ii/log_raw_can_messages.md","sourceDirName":"cloud/obd-ii","slug":"/cloud/obd-ii/log-raw-can-messages","permalink":"/cloud/obd-ii/log-raw-can-messages","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/cloud/obd-ii/log_raw_can_messages.md","tags":[],"version":"current","frontMatter":{"id":"log-raw-can-messages","title":"Log Raw CAN Messages","supportedDevices":["cm4"]},"sidebar":"sidebar","previous":{"title":"Debug Raw PID Queries","permalink":"/cloud/obd-ii/debug-raw-pid-queries"},"next":{"title":"Using the CAN Bus Commands","permalink":"/cloud/obd-ii/using-the-can-bus-commands"}}');var r=t(74848),i=t(28453),n=(t(58162),t(47886));const s={id:"log-raw-can-messages",title:"Log Raw CAN Messages",supportedDevices:["cm4"]},d=void 0,h={},c=[{value:"Reading Raw CAN Data",id:"reading-raw-can-data",level:2},{value:"<code>obd.monitor</code>",id:"obdmonitor",level:3},{value:"<code>obd.export</code>",id:"obdexport",level:3},{value:"<code>obd.import</code>",id:"obdimport",level:3},{value:"Making Sense of Raw CAN Data",id:"making-sense-of-raw-can-data",level:2}];function l(e){const o={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{supported:s.supportedDevices}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsxs)(o.p,{children:["It is possible to listen for raw ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," data on the OBD port. There are a couple of\nways that this can be accomplished - a slower python implementation and a faster, C implementation.\nIn this guide we will explore these two options and show the differences between the two. Later on\nwe will also explore how you can make sense of this raw data after it has been recorded."]}),"\n",(0,r.jsxs)(o.p,{children:["It is important to note that the monitoring tools can only be used as a part of an\n",(0,r.jsx)(o.a,{href:"/core/services/core-services-obd-manager",children:"OBD service"})," workflow. We won't get into details about how\nyou can create a service worker in this guide, however we do have the\n",(0,r.jsx)(o.a,{href:"/cloud/device_management/services/create-custom-workers",children:"Create Service Workers"})," guide which you can take a look at\nfor more details on how to create a worker and setup its workflow."]}),"\n",(0,r.jsxs)(o.h2,{id:"reading-raw-can-data",children:["Reading Raw ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," Data"]}),"\n",(0,r.jsxs)(o.p,{children:["Firstly, we will explore how to read the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," messages that are visible on the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," bus. These\nmessages will be raw, meaning that they will simply be binary data that is structured in a\nspecific way. Later on we will also explore how we can make sense of this raw ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," data by\ntransforming it into more readable format using DBC files that can automatically be generated\nfor your vehicle."]}),"\n",(0,r.jsx)(o.h3,{id:"obdmonitor",children:(0,r.jsx)(o.code,{children:"obd.monitor"})}),"\n",(0,r.jsxs)(o.p,{children:["The first and simplest way to monitor ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," data is with the\n",(0,r.jsx)(o.a,{href:"/core/services/core-services-obd-manager/#monitor",children:(0,r.jsx)(o.code,{children:"obd.monitor"})})," handler.\nThis handler will continuously listen on the OBD port looking for any data. This data\nwill then be transported down the workflow and there you will be able to use the different\nhooks to transform the data and finally return the data to the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/software-platform/cloud-management",children:"Cloud"}),", or save it to a file."]}),"\n",(0,r.jsxs)(o.p,{children:["For greater performance read on to the ",(0,r.jsx)(o.code,{children:"obd.export"})," handler. The image below shows an example\nsetup for an ",(0,r.jsx)(o.code,{children:"obd.monitor"})," worker."]}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{alt:"obd_monitor_worker",src:t(25087).A+"",width:"1209",height:"644"})}),"\n",(0,r.jsx)(o.h3,{id:"obdexport",children:(0,r.jsx)(o.code,{children:"obd.export"})}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.a,{href:"/core/services/core-services-obd-manager/#export",children:(0,r.jsx)(o.code,{children:"obd.export"})})," is basically\n",(0,r.jsx)(o.code,{children:"obd.monitor"})," on steroids. It is much faster than it's python counterpart and doesn't clog up the\n",(0,r.jsx)(o.a,{href:"https://www.autopi.io",children:"AutoPi"}),"'s resources as much. It starts up a separate process that does the monitoring,\ninstead of running as a part of the salt-minion process."]}),"\n",(0,r.jsxs)(o.p,{children:["This however means that the external process will have to attach to the OBD serial port\n(",(0,r.jsx)(o.code,{children:"/dev/serial0"}),"), which means that it won't be possible to use ",(0,r.jsx)(o.code,{children:"obd"})," commands to read ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," data.\nThis is because the ",(0,r.jsx)(o.code,{children:"obd.export"})," handler needs to be sure to catch all ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," messages and it won't\nrelease the lock on the device."]}),"\n",(0,r.jsxs)(o.p,{children:["This handler is also a bit different than other handlers, as it does not pass any meaningful\ndata down the workflow, instead it saves the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," messages to external files, which can then be\nread by ",(0,r.jsx)(o.code,{children:"obd.import"}),". The files are located in ",(0,r.jsx)(o.code,{children:"/opt/autopi/obd/export/protocol_N"})," where ",(0,r.jsx)(o.code,{children:"N"})," is\nthe protocol number for your vehicle. In that directory you will be able to see a number of log\nfiles which contain the raw data that has been recorded by the handler. An example setup for a\nworkflow can be seen below."]}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{alt:"obd_export_worker",src:t(91805).A+"",width:"1209",height:"663"})}),"\n",(0,r.jsx)(o.h3,{id:"obdimport",children:(0,r.jsx)(o.code,{children:"obd.import"})}),"\n",(0,r.jsxs)(o.p,{children:["In order to actually be able to use the recorded data by ",(0,r.jsx)(o.code,{children:"obd.export"})," within the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io",children:"AutoPi"})," Core system,\nwe need to somehow import it. This is where\n",(0,r.jsx)(o.a,{href:"/core/services/core-services-obd-manager/#import",children:(0,r.jsx)(o.code,{children:"obd.import"})})," comes in -\nit reads the data that was written to the log files by ",(0,r.jsx)(o.code,{children:"obd.export"})," and passes it down the workflow.\nIt is simply a workflow enabler, meaning that after you read the data, you can transform it in any\nway you'd like, execute any triggers and use a returner to save the data on the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/software-platform/cloud-management",children:"Cloud"})," or a local\nfile, just like with ",(0,r.jsx)(o.code,{children:"obd.monitor"}),"."]}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{alt:"obd_import_worker",src:t(24218).A+"",width:"1209",height:"644"})}),"\n",(0,r.jsxs)(o.h2,{id:"making-sense-of-raw-can-data",children:["Making Sense of Raw ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," Data"]}),"\n",(0,r.jsxs)(o.p,{children:["A key converter that can be used in the workflows described above is the\n",(0,r.jsx)(o.a,{href:"/core/services/core-services-obd-manager/#can",children:"CAN converter"}),". It is able\nto read the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," database file that you have for your vehicle's protocol and transform the binary\ndata that has been passed to it into a more sensible format. Both ",(0,r.jsx)(o.code,{children:"obd.monitor"})," and ",(0,r.jsx)(o.code,{children:"obd.import"}),"\nuse the ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," converter in the workflows to sanitize the data."]}),"\n",(0,r.jsxs)(o.p,{children:["It is important to note however, that the DBC (",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," database) file would only be available if you have\nsetup ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"})," loggers for your device. In the ",(0,r.jsx)(o.a,{href:"https://my.autopi.io",children:"AutoPi Cloud"})," navigate to\nDevice > Loggers where you'll be able to see all the loggers you currently have. They need to\nbe of type ",(0,r.jsx)(o.a,{href:"https://www.autopi.io/hardware/autopi-canfd-pro",children:"CAN"}),". There are a few guides that you can take a look at to get them up an running:"]}),"\n",(0,r.jsxs)(o.ol,{children:["\n",(0,r.jsxs)(o.li,{children:["\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"/getting_started/electric_vehicles/power-cycle-for-electric-vehicles/",children:"How to setup power cycle for an electric vehicle"})}),"\n"]}),"\n",(0,r.jsxs)(o.li,{children:["\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"/cloud/obd_library/car-explorer-library-manual/#importing-library-items-from-files",children:"How to import custom DBC files"})}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},47886:(e,o,t)=>{t.d(o,{A:()=>i});t(96540);var a=t(74848);const r={mini:{name:"Mini",image:"/img/hardware/autopi_mini/AutoPi_Mini_5_Top_right.png"},cm4:{name:"TMU CM4",image:"/img/hardware/autopi_tmu_cm4/TMU_Floating_Topside_V1_scaled.png"},pro:{name:"CAN-FD Pro",image:"/img/hardware/autopi_canfd_pro/canfd_pro_trans.png"}};function i(e){let{supported:o}=e;return o?.length?(0,a.jsxs)("div",{style:{padding:"1rem",marginBottom:"1.5rem"},children:[(0,a.jsx)("strong",{children:"This guide is applicable to the following device/ devices:"}),(0,a.jsx)("div",{style:{display:"flex",gap:"1.5rem",marginTop:"0.5rem"},children:o.map((e=>{const o=r[e];return(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("img",{src:o.image,alt:o.name,style:{height:"60px",marginBottom:"0.25rem"}}),(0,a.jsx)("div",{children:o.name})]},e)}))})]}):null}},58162:(e,o,t)=>{t.d(o,{A:()=>n});t(96540);const a="homeGrid_MM9h",r="cardGrid_IPp8";var i=t(74848);const n=e=>{let{children:o,home:t=!1}=e;return(0,i.jsx)("div",{className:t?a:r,children:o})}},91805:(e,o,t)=>{t.d(o,{A:()=>a});const a=t.p+"assets/images/obd_export_worker-652bf565d5f705940197ebadd37e7730.png"}}]);