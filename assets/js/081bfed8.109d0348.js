"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[1013],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var i=t(96540);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}},35727:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/key_state_denied-ab5b0efd2c5c8d6e7b518fc03680f438.png"},47886:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);var i=t(74848);const o={mini:{name:"Mini",image:"/img/hardware/autopi_mini/AutoPi_Mini_5_Top_right.png"},cm4:{name:"TMU CM4",image:"/img/hardware/autopi_tmu_cm4/TMU_Floating_Topside_V1_scaled.png"},pro:{name:"CAN-FD Pro",image:"/img/hardware/autopi_canfd_pro/canfd_pro_trans.png"}};function r(e){let{supported:n}=e;return n?.length?(0,i.jsxs)("div",{style:{padding:"1rem",marginBottom:"1.5rem"},children:[(0,i.jsx)("strong",{children:"This guide is applicable to the following device/ devices:"}),(0,i.jsx)("div",{style:{display:"flex",gap:"1.5rem",marginTop:"0.5rem"},children:n.map((e=>{const n=o[e];return(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("img",{src:n.image,alt:n.name,style:{height:"60px",marginBottom:"0.25rem"}}),(0,i.jsx)("div",{children:n.name})]},e)}))})]}):null}},58162:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);const i="homeGrid_MM9h",o="cardGrid_IPp8";var r=t(74848);const s=e=>{let{children:n,home:t=!1}=e;return(0,r.jsx)("div",{className:t?i:o,children:n})}},64085:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"cloud/device_management/move-to-dedicated-environment","title":"Move Device to a Dedicated Environment","description":"---","source":"@site/docs/cloud/device_management/move_to_dedicated_environment.md","sourceDirName":"cloud/device_management","slug":"/cloud/device_management/move-to-dedicated-environment","permalink":"/cloud/device_management/move-to-dedicated-environment","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/cloud/device_management/move_to_dedicated_environment.md","tags":[],"version":"current","frontMatter":{"id":"move-to-dedicated-environment","title":"Move Device to a Dedicated Environment","supportedDevices":["cm4","pro"]},"sidebar":"sidebar","previous":{"title":"Software Updates","permalink":"/cloud/device_management/software-updates"},"next":{"title":"Geofences","permalink":"/cloud/device_management/geofences"}}');var o=t(74848),r=t(28453),s=(t(58162),t(47886));const a={id:"move-to-dedicated-environment",title:"Move Device to a Dedicated Environment",supportedDevices:["cm4","pro"]},d=void 0,c={},h=[{value:"1. First We Need to Change the Host to Which the Device Connects.",id:"1-first-we-need-to-change-the-host-to-which-the-device-connects",level:2},{value:"A. For Versions <strong>AFTER</strong> 2021.08.05",id:"a-for-versions-after-20210805",level:3},{value:"B. For Versions <strong>BEFORE</strong> 2021.08.05",id:"b-for-versions-before-20210805",level:3},{value:"2. Accepting the Device In the Dedicated Environment.",id:"2-accepting-the-device-in-the-dedicated-environment",level:2},{value:"3. Re-Applying Any Custom Settings.",id:"3-re-applying-any-custom-settings",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.A,{supported:a.supportedDevices}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:["In this short guide we will talk about how you can move your device from the default production\nenvironment to your dedicated environment provided by ",(0,o.jsx)(n.a,{href:"https://www.autopi.io",children:"AutoPi"}),". Unfortunately, this process moves\nonly one device at a time, so you will need to repeat the steps for each device you need to move."]}),"\n",(0,o.jsx)(n.h2,{id:"1-first-we-need-to-change-the-host-to-which-the-device-connects",children:"1. First We Need to Change the Host to Which the Device Connects."}),"\n",(0,o.jsx)(n.p,{children:"How this is done depends on what version of the core you have on your device."}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:'Find the version currently deployed on your device by going to the "Software Updates" page.'})}),"\n",(0,o.jsxs)(n.h3,{id:"a-for-versions-after-20210805",children:["A. For Versions ",(0,o.jsx)(n.strong,{children:"AFTER"})," 2021.08.05"]}),"\n",(0,o.jsxs)(n.p,{children:["For all versions after ",(0,o.jsx)(n.strong,{children:"2021.08.05"}),", you will only need to run the ",(0,o.jsx)(n.em,{children:"change_master"})," command."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# First we change the master host.\n$ minionutil.change_master yourcompany.autopi.io confirm=True\n\n# Then we restart the minion\n$ minionutil.restart\n"})}),"\n",(0,o.jsxs)(n.h3,{id:"b-for-versions-before-20210805",children:["B. For Versions ",(0,o.jsx)(n.strong,{children:"BEFORE"})," 2021.08.05"]}),"\n",(0,o.jsxs)(n.p,{children:["This version of the core also requires you to modify the ",(0,o.jsx)(n.code,{children:"/boot/host.aliases"})," file to\npoint to your dedicated environment. Firstly, we need to change the master URL to point to your\ndedicated server, in this example it is ",(0,o.jsx)(n.code,{children:"yourcompany.autopi.io"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ cmd.shell \'echo "hub yourcompany.autopi.io" > "/boot/host.aliases"\'\n'})}),"\n",(0,o.jsx)(n.p,{children:"Next, we need to make sure that the master is specified correctly in the salt-minion configuration\nfile:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ minionutil.change_master hub confirm=True\n"})}),"\n",(0,o.jsx)(n.p,{children:"The above command will ensure the salt-minion configuration is set correctly and restart the\nsalt-minion."}),"\n",(0,o.jsx)(n.h2,{id:"2-accepting-the-device-in-the-dedicated-environment",children:"2. Accepting the Device In the Dedicated Environment."}),"\n",(0,o.jsxs)(n.p,{children:["Lastly, we need to accept the new device's keys. You can do that by logging in to your\nwebpage (",(0,o.jsx)(n.a,{href:"https://dedicated.autopi.io/#account/devices",children:"https://dedicated.autopi.io/#account/devices"}),") and registering your device if it isn't\nalready."]}),"\n",(0,o.jsx)(n.p,{children:"Once you have it registered and you have brought the device online, accept the key under the device settings."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Key state denied",src:t(35727).A+"",width:"1166",height:"214"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"When accepting the key you might receive a 404 error saying that the key for that device was not\nfound. If that's the case, most likely your device was unable to get connected to the environment\nyet. Make sure that you have internet connection and that you have typed in the URL of your dedicated\nenvironment correctly."})}),"\n",(0,o.jsx)(n.p,{children:"When that is done, you'll need to restart the salt-minion once more, either by waiting for it to go to sleep, or by issuing the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# if running the command directly on the device (e.g. SSH)\n$ sudo systemctl restart salt-minion\n\n# if running the command through a web terminal\n$ minionutil.restart\n"})}),"\n",(0,o.jsx)(n.h2,{id:"3-re-applying-any-custom-settings",children:"3. Re-Applying Any Custom Settings."}),"\n",(0,o.jsx)(n.p,{children:"Since you just moved the device from one environment to another, it is important that you recognize that any settings that was applied on the old environment, will not be migrated automatically unless we explicitly let you know this has been done."}),"\n",(0,o.jsxs)(n.p,{children:["This means that you must ensure that the device is using the right settings for your use case.\nTo make sure that the device has all the right configuration applied (They might differ between environments), you should go to the ",(0,o.jsx)(n.code,{children:"Software Updates"})," page, and reapply the current version, by clicking ",(0,o.jsx)(n.code,{children:"enqueue update"}),", that way you ensure that the device is fully in sync with the current environment."]}),"\n",(0,o.jsx)(n.p,{children:"You should now be able to make configuration changes, execute commands and so on."})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);