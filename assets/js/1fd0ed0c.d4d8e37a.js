"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[7010],{28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>l});var i=n(96540);const s={},o=i.createContext(s);function r(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:t},e.children)}},48985:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"core/power_management/core-power-sleep-timers","title":"Sleep Timers","description":"Sleep timers are a functionality built into the AutoPi who\'s purpose is to protect the battery of your vehicle by","source":"@site/docs/core/power_management/sleep_timers.md","sourceDirName":"core/power_management","slug":"/core/power_management/core-power-sleep-timers","permalink":"/core/power_management/core-power-sleep-timers","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/core/power_management/sleep_timers.md","tags":[],"version":"current","frontMatter":{"id":"core-power-sleep-timers","title":"Sleep Timers"},"sidebar":"sidebar","previous":{"title":"Low-level","permalink":"/core/power_management/core-power-low"},"next":{"title":"Introduction","permalink":"/core/returners/"}}');var s=n(74848),o=n(28453);n(58162);const r={id:"core-power-sleep-timers",title:"Sleep Timers"},l=void 0,a={},c=[{value:"The <code>power.sleep_timer</code> Command",id:"the-powersleep_timer-command",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Power &gt; Sleep Timer",id:"power--sleep-timer",level:3},{value:"Setting Sleep Timers",id:"setting-sleep-timers",level:4},{value:"Suppressing Sleep Timers",id:"suppressing-sleep-timers",level:4},{value:"<code>Event Regex</code>",id:"event-regex",level:5},{value:"<code>Schedule</code>",id:"schedule",level:5},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"My Device is Constantly Shutting Down, Even Though My Vehicle is On and Driving",id:"my-device-is-constantly-shutting-down-even-though-my-vehicle-is-on-and-driving",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Sleep timers are a functionality built into the ",(0,s.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"})," who's purpose is to protect the battery of your vehicle by\nlimiting the amount of power required by the device when it's plugged into a vehicle. On this page, we will explore how\nyou can work with the sleep timers using a command and look over some of the configuration options that are available\nto manipulate how sleep timers are added and cleared from the device."]}),"\n",(0,s.jsxs)(t.h2,{id:"the-powersleep_timer-command",children:["The ",(0,s.jsx)(t.code,{children:"power.sleep_timer"})," Command"]}),"\n",(0,s.jsxs)(t.p,{children:["Let us start by going through the command that you can use to view, set and clear sleep timers. The command is\n",(0,s.jsx)(t.a,{href:"/core/commands/core-commands-power#powersleep_timer",children:(0,s.jsx)(t.code,{children:"power.sleep_timer"})}),". If you execute the command on its own, it will return\nthe currently set sleep timers on the device:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"user@my_device $ power.sleep_timer \n_sleep_timer/inactivity_fallback:\n  function: power.sleep\n  _stamp: '2023-05-08T09:26:57.353790'\n  name: _sleep_timer/inactivity_fallback\n  seconds: 10800\n  enabled: true\n  job_args: []\n  return_job: false\n  jid_include: true\n  maxrunning: 1\n  job_kwargs:\n    delay: 60\n    reason: inactivity_fallback\n    interval: 21600\n    confirm: true\n  metadata:\n    transient: true\n    revision: 2\n    expires: '2023-05-08T12:25:13.961144'\n    created: '2023-05-08T09:25:13.961144'\n"})}),"\n",(0,s.jsxs)(t.p,{children:["In the code snippet above, we can see that there is a sleep timer currently set for ",(0,s.jsx)(t.code,{children:"my_device"})," - the\n",(0,s.jsx)(t.code,{children:"_sleep_timer/inactivity_fallback"})," sleep timer. That sleep timer will expire at ",(0,s.jsx)(t.code,{children:"2023-05-08T12:25:13.961144"})," - note\nthat this timestamp is in UTC, as are all timestamps generated by an ",(0,s.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"})," device. The ",(0,s.jsx)(t.code,{children:"expires"}),' key shows the moment\nin time when the device will initiate its "Going to sleep" sequence.']}),"\n",(0,s.jsxs)(t.p,{children:["To clear all sleep timers, we can use the command together with the ",(0,s.jsx)(t.code,{children:"clear"})," keyword argument, like so:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"user@my_device $ power.sleep_timer clear=*\n{}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["We are also able to clear sleep timers based on their name. For example, we have the ",(0,s.jsx)(t.code,{children:"_sleep_timer/inactivity_fallback"}),"\nsleep timer above. Note that the actual name of the sleep timer in this example is ",(0,s.jsx)(t.code,{children:"inactivity_fallback"}),", omitting the\n",(0,s.jsx)(t.code,{children:"_sleep_timer/"})," part. Now, we can execute the command like below, to clear that specific sleep timer:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"user@my_device $ power.sleep_timer clear=inactivity_fallback\n{}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If we run the ",(0,s.jsx)(t.code,{children:"power.sleep_timer"})," command on it's own and it returns an empty response like below, that means there\nare no sleep timers currently set on the device:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"user@my_device $ power.sleep_timer\n{}\n"})}),"\n",(0,s.jsx)(t.p,{children:"If you don't see any sleep timers set, that means the device won't go down to sleep. Or at least, until a new sleep\ntimer is set. A new sleep timer can be set in different situations, based on the configuration of the device, but it's\nimportant to remember that there could be new sleep timers set, even if you clear all current timers. Usually, this\nhappens only when the device detects that a trip with a vehicle has ended, using the Event Driven sleep timer (we will\nexplore that a little later)."}),"\n",(0,s.jsx)(t.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,s.jsxs)(t.p,{children:["Now, it's time for us to look through how we can configure the automatic sleep timers of the ",(0,s.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"}),". We will explore\nfirst how to automate setting of sleep timers (i.e. when the device should go to sleep and for how long). Then, we will\nalso look into how we can automate the clearing of sleep timers."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["You can see all available power configuration options ",(0,s.jsx)(t.a,{href:"/cloud/device_management/advanced_settings/autopi_tmu_cm4/cloud-config-power",children:"here"}),"."]})}),"\n",(0,s.jsx)(t.h3,{id:"power--sleep-timer",children:"Power > Sleep Timer"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.a,{href:"/cloud/device_management/advanced_settings/autopi_tmu_cm4/cloud-config-power#sleep-timer",children:"sleep timer"})," section of the Advanced Power settings allows you to\nconfigure how the device behaves in terms of setting and clearing sleep timers automatically. The ",(0,s.jsx)(t.code,{children:"Event Driven"}),",\n",(0,s.jsx)(t.code,{children:"Inactivity After Sleep"})," and ",(0,s.jsx)(t.code,{children:"Inactivity Fallback"})," settings configure how the device goes to sleep, while the ",(0,s.jsx)(t.code,{children:"Suppress"}),"\nsection configures the device on how to stay awake."]}),"\n",(0,s.jsx)(t.h4,{id:"setting-sleep-timers",children:"Setting Sleep Timers"}),"\n",(0,s.jsx)(t.p,{children:"Firstly, let's take a look at the settings that set sleep timers.\nThe common settings amongst all of them are the following:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Period"})," - The period defines how long the device will stay awake for before going to sleep due to this sleep timer."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Interval"})," - The interval defines the amount of time the device will sleep for, due to this sleep timer."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Delay"})," - The delay is the amount of time to wait before going to sleep. The delay is applied after the period has\nexpired, but before the device actually powers off."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Now, let's discuss the functionalities each one brings to the table:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Event Driven"})," - The ",(0,s.jsx)(t.code,{children:"Even Driven"})," sleep timer get's set when the event defined in its ",(0,s.jsx)(t.code,{children:"Event Regex"})," option is\ntriggered by the device. This event can either be one of the default ones (like\n",(0,s.jsx)(t.a,{href:"/cloud/device_management/events/cloud-events-vehicle#engine-events",children:"Engine events"})," such as ",(0,s.jsx)(t.code,{children:"vehicle/engine/stopped"})," or\n",(0,s.jsx)(t.a,{href:"/cloud/device_management/events/cloud-events-vehicle#communication-events",children:"Communication events"})," such as ",(0,s.jsx)(t.code,{children:"vehicle/communication/disconnected"}),").\nThe purpose of this sleep timer is to put the device to sleep when we have detected that the vehicle is no longer\nbeing used (hence the engine/stopped instead of engine/running, which we will see in the suppress settings further\ndown)."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Inactivity After Sleep"})," - The ",(0,s.jsx)(t.code,{children:"Inactivity After Sleep"})," sleep timer get's set when the device wakes up and does not\nsee the event defined in the ",(0,s.jsx)(t.em,{children:"Suppress > Event Regex"})," configuration (explained in next section). This sleep timer is\nusually set when the device wakes up from its sleep due to an expired ",(0,s.jsx)(t.code,{children:"Interval"}),", but the vehicle the device is\nplugged into isn't on or running."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Inactivity Fallback"})," - The ",(0,s.jsx)(t.code,{children:"Inactivity Fallback"})," sleep timer get's set when the device has been freshly plugged\ninto a power source, the event defined in the ",(0,s.jsx)(t.code,{children:"Event Driven"})," regex isn't seen and the suppress event hasn't been\ntriggered in this power cycle. In essence it works exactly the same as the ",(0,s.jsx)(t.code,{children:"Inactivity After Sleep"})," sleep timer,\nhowever is only triggered upon first plugging in the device into power."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"suppressing-sleep-timers",children:"Suppressing Sleep Timers"}),"\n",(0,s.jsxs)(t.p,{children:["Now, let's explore the ",(0,s.jsx)(t.code,{children:"Suppress"})," section of the Advanced Power settings. This section defines how the device will\nclear and suppress further sleep timers from putting the device to sleep. There's two options available in this\nsection - ",(0,s.jsx)(t.code,{children:"Event Regex"})," and ",(0,s.jsx)(t.code,{children:"Schedule"}),"."]}),"\n",(0,s.jsx)(t.h5,{id:"event-regex",children:(0,s.jsx)(t.code,{children:"Event Regex"})}),"\n",(0,s.jsxs)(t.p,{children:["Let's start with the ",(0,s.jsx)(t.code,{children:"Event Regex"}),". This option allows you to set a regex pattern that will be matched against every\nevent that get's triggered inside the device. What this allows us to do is to set a specific event, that when triggered,\nwill clear all sleep timers that have been setup on the device. It also prevents new sleep timers from being set until\nanother event is seen (specifically, the ",(0,s.jsx)(t.code,{children:"Event Regex"})," from the ",(0,s.jsx)(t.code,{children:"Event Driven"})," sleep timer)."]}),"\n",(0,s.jsxs)(t.p,{children:["Common examples here are using the opposite events from the ",(0,s.jsx)(t.code,{children:"Event Driven"})," sleep timer:\n",(0,s.jsx)(t.a,{href:"/cloud/device_management/events/cloud-events-vehicle#engine-events",children:"Engine events"})," like ",(0,s.jsx)(t.code,{children:"vehicle/engine/started"})," or\n",(0,s.jsx)(t.a,{href:"/cloud/device_management/events/cloud-events-vehicle#communication-events",children:"Communication events"})," like ",(0,s.jsx)(t.code,{children:"vehicle/communication/established"}),". Note that\nhere, we are looking for an event that shows the vehicle is now being driven, so we want to clear the sleep timers as\nwe don't want the device to go to sleep, but instead record all of our data."]}),"\n",(0,s.jsx)(t.h5,{id:"schedule",children:(0,s.jsx)(t.code,{children:"Schedule"})}),"\n",(0,s.jsxs)(t.p,{children:["Next, we have the ",(0,s.jsx)(t.code,{children:"Schedule"})," option. That option allows us to setup a schedule for the device for when it should be\nawake and how long it should be awake for. This option is useful for situations where you need the device to be awake\nat specific times of the day and stay awake for the necessary duration. The way this setting is defined is by writing\na cron expression, then the pipe sign (",(0,s.jsx)(t.code,{children:"|"}),"), followed by the amount of time the device should be awake for in seconds.\nLet's go through an example:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"0 9 9 5 * | 3600\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If we grab just the ",(0,s.jsx)(t.code,{children:"0 9 9 5 *"})," part, which is the cron expression and paste it into a crontab resolver, we will find\nthat this expression will be executed on 9th May at 9:00 AM in UTC time. Remember that the devices are all working in\nUTC, so this (suppress) expression will also be resolved in UTC. Next, the ",(0,s.jsx)(t.code,{children:"3600"})," portion says that the device will\nstay awake starting at that time for 1 hour in the future."]}),"\n",(0,s.jsxs)(t.p,{children:["This means that the device will be woken up at the appropriate time and then any sleep timers that are added to the\ndevice will be adjusted to ensure the device will be awake for the desired duration. For example, suppose we have set\nthe suppress schedule to keep the device up for the next hour. Now, if the device automatically adds a sleep timer, or\nif we add it manually using the ",(0,s.jsx)(t.code,{children:"power.sleep_timer"})," command, the new sleep timer set will be adjusted so that it only\nputs the device to sleep after the hour from the suppress schedule passes."]}),"\n",(0,s.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(t.h3,{id:"my-device-is-constantly-shutting-down-even-though-my-vehicle-is-on-and-driving",children:"My Device is Constantly Shutting Down, Even Though My Vehicle is On and Driving"}),"\n",(0,s.jsxs)(t.p,{children:["It's important to remember that the ",(0,s.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"})," device will automatically setup sleep timers in an attempt to protect your\nvehicle's battery. This will happen even if there are no custom configurations setup or without any interference by the\nuser. This usually causes confusion as to why the device isn't on, even though it should be on and recording data."]}),"\n",(0,s.jsx)(t.p,{children:"The cause for this is usually because the device hasn't been setup to listen to the correct data and/or events, in order\nto suppress (aka clear) sleep timers when the vehicle is being driven. If the device is plugged into an electric vehicle\nthat can be a bit more difficult to accomplish."})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},58162:(e,t,n)=>{n.d(t,{A:()=>r});n(96540);const i="homeGrid_MM9h",s="cardGrid_IPp8";var o=n(74848);const r=e=>{let{children:t,home:n=!1}=e;return(0,o.jsx)("div",{className:n?i:s,children:t})}}}]);