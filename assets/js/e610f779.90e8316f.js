"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[9855],{4748:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/api_frontpage-d2e366bace40189a4d20d6cbd45324ac.jpg"},16340:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/account_overview-a806690fe1aadae78d5d294ec7e1ea71.png"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},39700:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"getting_started/api/api-intro","title":"Introduction","description":"---","source":"@site/docs/getting_started/api/index.md","sourceDirName":"getting_started/api","slug":"/getting_started/api/","permalink":"/getting_started/api/","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/getting_started/api/index.md","tags":[],"version":"current","frontMatter":{"id":"api-intro","title":"Introduction","supportedDevices":["mini","cm4"]},"sidebar":"sidebar","previous":{"title":"Power Cycles","permalink":"/getting_started/electric_vehicles/power-cycle-for-electric-vehicles"},"next":{"title":"Command Webhook Callbacks","permalink":"/getting_started/api/command-webhook-callbacks"}}');var o=t(74848),s=t(28453),r=(t(58162),t(47886));const a={id:"api-intro",title:"Introduction",supportedDevices:["mini","cm4"]},l=void 0,d={},h=[{value:"Authentication",id:"authentication",level:2},{value:"1. API Tokens",id:"1-api-tokens",level:3},{value:"Creation of the API Token",id:"creation-of-the-api-token",level:4},{value:"2. JWT Token",id:"2-jwt-token",level:3},{value:"Receiving the JWT Token",id:"receiving-the-jwt-token",level:4},{value:"3. Sending the Requests Manually Using Postman or Similar",id:"3-sending-the-requests-manually-using-postman-or-similar",level:3},{value:"Telemetry data examples",id:"telemetry-data-examples",level:2},{value:"1.Getting positions",id:"1getting-positions",level:3},{value:"2. Battery Voltage readings",id:"2-battery-voltage-readings",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.A,{supported:a.supportedDevices}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:["You are able to use the ",(0,o.jsx)(n.a,{href:"https://api.autopi.io",children:"AutoPi REST API"})," with your browser, which will display our\nauto-generated documentation portal."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"api_frontpage",src:t(4748).A+"",width:"1488",height:"1303"})}),"\n",(0,o.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,o.jsx)(n.p,{children:"If you want to test the endpoints, you can authenticate in the API documentation portal by setting the token to use\nwhen authenticating. In the picture above you can see there is a green 'Authorize' button which you need to press.\nThis is where you'll be pasting your token."}),"\n",(0,o.jsx)(n.p,{children:"It is possible to authenticate using two different tokens or sending the request manually using Postman (or similar)."}),"\n",(0,o.jsx)(n.h3,{id:"1-api-tokens",children:"1. API Tokens"}),"\n",(0,o.jsx)(n.p,{children:"Authentication should be done with the API tokens. These tokens can be generated in the account page. The expire date is optional. The tokens can then be used in external systems to authenticate the requests. To use the token, you simply set the Authorization header to the following value, when sending HTTP requests to the API:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Authorization: APIToken YOUR_TOKEN\n"})}),"\n",(0,o.jsx)(n.h4,{id:"creation-of-the-api-token",children:"Creation of the API Token"}),"\n",(0,o.jsxs)(n.p,{children:["You can ",(0,o.jsx)(n.strong,{children:"generate the new API Token"})," in the AutoPi ",(0,o.jsx)(n.a,{href:"https://my.autopi.io",children:"Cloud"}),". Clicking on the in the ",(0,o.jsx)(n.em,{children:"Account tab"})," in the side menu gets you to the ",(0,o.jsx)(n.em,{children:"Account Page"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["On the ",(0,o.jsx)(n.em,{children:"Account"})," Page you may see an API Tokens ",(0,o.jsx)(n.em,{children:"tab"})," which gets you to the API Token creation part.\nHere you are able to create a new API Token by giving it a name and there is an ",(0,o.jsx)(n.em,{children:"option"})," to set an expiration date for the token if you need and clicking the ",(0,o.jsx)(n.em,{children:"Create"})," button."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"account_page",src:t(16340).A+"",width:"1654",height:"944"})}),"\n",(0,o.jsx)(n.h3,{id:"2-jwt-token",children:"2. JWT Token"}),"\n",(0,o.jsx)(n.p,{children:"This token is the one used by the frontend when logging in. It expires relatively shortly and you need to enter you username and password to acquire the token."}),"\n",(0,o.jsx)(n.h4,{id:"receiving-the-jwt-token",children:"Receiving the JWT Token"}),"\n",(0,o.jsx)(n.p,{children:"You can get the JWT token in two different ways:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Capture the Token by Using the Browser Developer Tools"})," - the easiest way is to capture the token by logging into the ",(0,o.jsx)(n.a,{href:"https://www.autopi.io/software-platform/cloud-management",children:"Cloud"}),", with the developer tools open in your favourite\nbrowser, with the network tab open, and then skip to step 6 in the below step by step guide."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Manually Call the Auth Endpoint to get the Token."})," - you can follow the steps below to call the login endpoint manually."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:'Click the "auth" app to fold out the available endpoints.'}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:'Click the "/auth/login/".'}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:'Click the "try it out" button to the right.'}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Change the payload to look like this (remove the username field, and fill out the email and password fields, like so:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{\n    "email": "your_email",\n    "password": "your_insanely_complex_password"\n}\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:'Click the blue "execute" button.'}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Now you can copy the entire token."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:'Now click the green "Authorize" button in the top right of the page and paste the token in the field. Remember to write "Bearer" in front of the token - like so:'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.4pXwtyQKCwSrYfcj9O7MGVv5ustPbx0GmYY7jHZL8es\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"After clicking close, you should now be able to call the other authenticated endpoints."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"3-sending-the-requests-manually-using-postman-or-similar",children:"3. Sending the Requests Manually Using Postman or Similar"}),"\n",(0,o.jsx)(n.p,{children:"Alternatively, if you are unable to use the above portal, or if you'd rather use something like Postman or similar,\nyou can still see the requests and parameters in the portal, but to call them manually, see the below steps."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Authenticating manually w/o interactive API documentation portal"})," - you can do the above steps manually by following these steps:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Authentication\nTo obtain an authentication token, send a post request to ",(0,o.jsx)(n.a,{href:"https://api.autopi.io/auth/login/",children:"https://api.autopi.io/auth/login/"}),"\nwith header"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Content-Type: application/json\n"})}),"\n",(0,o.jsx)(n.p,{children:"and body"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{ "email": "your email address", "password": "your password" }\n'})}),"\n",(0,o.jsx)(n.p,{children:"In the response, you will find the token used to authenticate the below requests"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"To request data from our API, the authorization header should be set."}),"\n",(0,o.jsx)(n.p,{children:'You will need to set the "Authorization" header on the requests. To set the header, use the below values.'}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"If you're using a JWT token:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Authorization: Bearer YOUR_TOKEN\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"If you're using an API token:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Authorization: APIToken YOUR_TOKEN\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["If you find something where you are unsure how to proceed, you can log in to my.autopi.io and use the developer tools\nof your favourite browser to see the requests and parameters sent by the application, and if you are still experiencing\nissues, you can send us an email to ",(0,o.jsx)(n.a,{href:"mailto:support@autopi.io",children:"support@autopi.io"})]})}),"\n",(0,o.jsx)(n.h2,{id:"telemetry-data-examples",children:"Telemetry data examples"}),"\n",(0,o.jsx)(n.p,{children:"Accessing data from a device is done by calling the logbook endpoint."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Logbook Storage Read Parameters:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"device_id:"})," ID of the device you want to retrieve data from."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"field:"})," Name of the field you want to retrieve the value from."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"field_type:"})," type of the field"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"from_utc:"})," ISO Datetime string"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"to_utc:"})," ISO Datetime string"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"aggregation:"})," Aggregation method (AVG, MIN, MAX, SUM)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"interval:"})," Data is aggregated based on the aggregation method specified, the interval specifies how many groups the data is grouped into. For example, getting data for a 10 hour period, with the interval set to 1h, you will get back 10 values, one value per hour."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"1getting-positions",children:"1.Getting positions"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"GET /logbook/storage/read/\n?device_id=DEVICE_ID\n&field=track.pos.loc\n&field_type=geo_point\n&from_utc=2020-01-01T00:00:00.000Z\n&to_utc=2020-01-01T01:00:00.000Z\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'[\n    {\n            "ts": "2020-07-09T10:11:53.811839Z",\n            "location": {\n                    "lat": 57.04699,\n                    "lon": 9.93909\n            }\n    },\n    {\n            "ts": "2020-07-09T10:11:59.248421Z",\n            "location": {\n                    "lat": 57.04697,\n                    "lon": 9.93808\n            }\n    }\n]\n'})}),"\n",(0,o.jsx)(n.h3,{id:"2-battery-voltage-readings",children:"2. Battery Voltage readings"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"GET /logbook/storage/read/\n?device_id=DEVICE_ID\n&field=obd.bat.voltage\n&field_type=float\n&aggregation=avg\n&from_utc=2020-01-01T00:00:00.000Z\n&to_utc=2020-01-01T01:00:00.000Z\n&interval=10m\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'[\n\t{\n    \t    "max_ts": 1594289021415,\n    \t    "ts": "2020-07-09T10:03:37.566Z",\n    \t    "value": 13.5\n\t},\n\t{\n    \t    "max_ts": 1594289026525,\n    \t    "ts": "2020-07-09T10:13:45.378Z",\n    \t    "value": 13.600000381469727\n\t}\n]\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},47886:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var i=t(74848);const o={mini:{name:"Mini",image:"/img/hardware/autopi_mini/AutoPi_Mini_5_Top_right.png"},cm4:{name:"TMU CM4",image:"/img/hardware/autopi_tmu_cm4/TMU_Floating_Topside_V1_scaled.png"},pro:{name:"CAN-FD Pro",image:"/img/hardware/autopi_canfd_pro/canfd_pro_trans.png"}};function s(e){let{supported:n}=e;return n?.length?(0,i.jsxs)("div",{style:{padding:"1rem",marginBottom:"1.5rem"},children:[(0,i.jsx)("strong",{children:"This guide is applicable to the following device/ devices:"}),(0,i.jsx)("div",{style:{display:"flex",gap:"1.5rem",marginTop:"0.5rem"},children:n.map((e=>{const n=o[e];return(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("img",{src:n.image,alt:n.name,style:{height:"60px",marginBottom:"0.25rem"}}),(0,i.jsx)("div",{children:n.name})]},e)}))})]}):null}},58162:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);const i="homeGrid_MM9h",o="cardGrid_IPp8";var s=t(74848);const r=e=>{let{children:n,home:t=!1}=e;return(0,s.jsx)("div",{className:t?i:o,children:n})}}}]);