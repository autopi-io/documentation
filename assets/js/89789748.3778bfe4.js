"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[3599],{7106:(e,o,n)=>{n.d(o,{A:()=>i});const i=n.p+"assets/images/local_admin_log_files-b467a05a875bdef5f151653b5bae294b.jpg"},28453:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>r});var i=n(96540);const t={},l=i.createContext(t);function s(e){const o=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(l.Provider,{value:o},e.children)}},47886:(e,o,n)=>{n.d(o,{A:()=>l});n(96540);var i=n(74848);const t={mini:{name:"Mini",image:"/img/hardware/autopi_mini/AutoPi_Mini_5_Top_right.png"},cm4:{name:"TMU CM4",image:"/img/hardware/autopi_tmu_cm4/TMU_Floating_Topside_V1_scaled.png"},pro:{name:"CAN-FD Pro",image:"/img/hardware/autopi_canfd_pro/canfd_pro_trans.png"}};function l(e){let{supported:o}=e;return o?.length?(0,i.jsxs)("div",{style:{padding:"1rem",marginBottom:"1.5rem"},children:[(0,i.jsx)("strong",{children:"This guide is applicable to the following device/ devices:"}),(0,i.jsx)("div",{style:{display:"flex",gap:"1.5rem",marginTop:"0.5rem"},children:o.map((e=>{const o=t[e];return(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("img",{src:o.image,alt:o.name,style:{height:"60px",marginBottom:"0.25rem"}}),(0,i.jsx)("div",{children:o.name})]},e)}))})]}):null}},58162:(e,o,n)=>{n.d(o,{A:()=>s});n(96540);const i="homeGrid_MM9h",t="cardGrid_IPp8";var l=n(74848);const s=e=>{let{children:o,home:n=!1}=e;return(0,l.jsx)("div",{className:n?i:t,children:o})}},76450:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"developer_guides/autopi-logs","title":"AutoPi Logs","description":"---","source":"@site/docs/developer_guides/autopi_logs.md","sourceDirName":"developer_guides","slug":"/developer_guides/autopi-logs","permalink":"/developer_guides/autopi-logs","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/developer_guides/autopi_logs.md","tags":[],"version":"current","frontMatter":{"id":"autopi-logs","title":"AutoPi Logs","supportedDevices":["cm4","pro"]},"sidebar":"sidebar","previous":{"title":"Setting Up a Device with Verizon Wireless","permalink":"/developer_guides/setting-up-a-device-with-verizon-wireless"},"next":{"title":"AutoPi Local API Overview","permalink":"/developer_guides/local-api-overview"}}');var t=n(74848),l=n(28453),s=(n(58162),n(47886));const r={id:"autopi-logs",title:"AutoPi Logs",supportedDevices:["cm4","pro"]},a=void 0,d={},c=[{value:"Viewing Logs",id:"viewing-logs",level:2},{value:"Viewing Logs From the Cloud",id:"viewing-logs-from-the-cloud",level:3},{value:"Viewing Logs Directly On the Device",id:"viewing-logs-directly-on-the-device",level:3},{value:"Downloading Logs",id:"downloading-logs",level:2},{value:"1. Local Admin Page Download",id:"1-local-admin-page-download",level:3},{value:"2. SCP (SSH Copy)",id:"2-scp-ssh-copy",level:3},{value:"3. Uploading the Log File to Your Dropbox",id:"3-uploading-the-log-file-to-your-dropbox",level:3},{value:"Log Rotation",id:"log-rotation",level:2},{value:"<code>/var/log/salt/minion</code>",id:"varlogsaltminion",level:4},{value:"<code>/var/log/syslog</code>",id:"varlogsyslog",level:4}];function h(e){const o={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.A,{supported:r.supportedDevices}),"\n",(0,t.jsx)(o.hr,{}),"\n",(0,t.jsx)(o.p,{children:"In this guide we will talk about how you can manage your AutoPi's logs. The topics that we will\ncover are how you can view your device's logs and how you can download the log files to your\ncomputer."}),"\n",(0,t.jsx)(o.h2,{id:"viewing-logs",children:"Viewing Logs"}),"\n",(0,t.jsxs)(o.p,{children:["There are two primary methods for viewing your AutoPi's logs. The first method uses some commands\nthat you can write in the web terminal from the ",(0,t.jsx)(o.a,{href:"https://my.autopi.io",children:"Cloud"})," or the local admin\nfor your device. The second method retrieves the log files directly from the device through SSH."]}),"\n",(0,t.jsx)(o.h3,{id:"viewing-logs-from-the-cloud",children:"Viewing Logs From the Cloud"}),"\n",(0,t.jsxs)(o.p,{children:["To retrieve the primary logs from the device, we have some terminal commands that can be executed\n(on ",(0,t.jsx)(o.a,{href:"https://my.autopi.io/",children:"my.autopi.io"})," and ",(0,t.jsx)(o.a,{href:"http://local.autopi.io/",children:"local.autopi.io"}),"):"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:"$ minionutil.last_logs\n$ minionutil.last_errors\n$ minionutil.last_startup\n"})}),"\n",(0,t.jsxs)(o.p,{children:["These functions can also take various parameters. You can check the documentation for those commands\n",(0,t.jsx)(o.a,{href:"/core/commands/core-commands-minionutil",children:"here"})," or by running the following command:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:"$ minionutil.help\n"})}),"\n",(0,t.jsx)(o.h3,{id:"viewing-logs-directly-on-the-device",children:"Viewing Logs Directly On the Device"}),"\n",(0,t.jsxs)(o.p,{children:["If you are logged onto the system using SSH (",(0,t.jsx)(o.a,{href:"/developer_guides/how-to-ssh-to-your-device",children:"How to SSH to your device"}),")\nyou can view the log file by running the following command:"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"$ less /var/log/salt/minion\n"})}),"\n",(0,t.jsx)(o.admonition,{type:"tip",children:(0,t.jsx)(o.p,{children:"Remember that the timestamps in the log files are in UTC."})}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(o.h2,{id:"downloading-logs",children:"Downloading Logs"}),"\n",(0,t.jsxs)(o.p,{children:["Sometimes, if we're having a back and forth on our support channel (",(0,t.jsx)(o.a,{href:"mailto:support@autopi.io",children:"support@autopi.io"}),"), we might\nask you to provide some log files from your device. Most of the time, it will be the minion log\nfile (",(0,t.jsx)(o.code,{children:"/var/log/salt/minion"}),"), but sometimes it might also be the syslog file (",(0,t.jsx)(o.code,{children:"/var/log/syslog"}),").\nThere are three ways that you can download log files from your device: downloading the files\nfrom the local admin page (",(0,t.jsx)(o.a,{href:"http://local.autopi.io",children:"local.autopi.io"}),"), copying it to your own computer with\nthe ",(0,t.jsx)(o.code,{children:"scp"})," command or by uploading it to your dropbox account."]}),"\n",(0,t.jsx)(o.h3,{id:"1-local-admin-page-download",children:"1. Local Admin Page Download"}),"\n",(0,t.jsxs)(o.p,{children:["To download the log files from the local admin page, you will need to connect to the device's WiFi\nhotspot first. After you've done that, you can navigate your browser to ",(0,t.jsx)(o.a,{href:"http://local.autopi.io",children:"http://local.autopi.io"}),"."]}),"\n",(0,t.jsx)(o.admonition,{type:"tip",children:(0,t.jsxs)(o.p,{children:["If the browser is unable to load the web page because it can't resolve the URL, try typing in the\nIP address instead: ",(0,t.jsx)(o.a,{href:"http://192.168.4.1",children:"http://192.168.4.1"}),"."]})}),"\n",(0,t.jsx)(o.p,{children:"Once you've opened the local admin page, on the right-hand side, you should see a list of the log\nfiles available for downloading. Click on the one you'd like to download."}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.img,{alt:"local_admin_log_files",src:n(7106).A+"",width:"1271",height:"637"})}),"\n",(0,t.jsx)(o.h3,{id:"2-scp-ssh-copy",children:"2. SCP (SSH Copy)"}),"\n",(0,t.jsxs)(o.p,{children:["You are able to download the minion log file using the ",(0,t.jsx)(o.code,{children:"scp"})," command from your computer. First,\nyou'll need to have the file in the home directory of the ",(0,t.jsx)(o.code,{children:"pi"})," user. The first two commands should\nbe run directly on the device (through SSH) and the last one should be run from your own computer."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"# copy the file to the home directory\n$ sudo cp /var/log/salt/minion /home/pi\n\n# make sure the pi user owns the file\n$ sudo chown pi:pi /home/pi/minion\n\n# finally, exit SSH and run the scp command from your own computer\nscp pi@local.autopi.io:~/minion ./\n"})}),"\n",(0,t.jsx)(o.p,{children:"After executing those commands, you should have a minion file in your current working directory."}),"\n",(0,t.jsx)(o.h3,{id:"3-uploading-the-log-file-to-your-dropbox",children:"3. Uploading the Log File to Your Dropbox"}),"\n",(0,t.jsx)(o.p,{children:"If you're not familiar with SSH or you don't have access to it at the moment, you can instead\nupload the log file to your dropbox account. Here are the steps you need to take to get the log\nfile uploaded:"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:["Create a Dropbox app by going here and input like so:\n",(0,t.jsx)(o.a,{href:"https://www.dropbox.com/developers/apps/create",children:"https://www.dropbox.com/developers/apps/create"})]}),"\n"]}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.img,{alt:"dropbox_create_app",src:n(90511).A+"",width:"573",height:"710"})}),"\n",(0,t.jsxs)(o.ol,{start:"2",children:["\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:["Go to the Permissions tab and make sure that the ",(0,t.jsx)(o.strong,{children:"files.content.write"})," permission is enabled."]}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:['Now go back to the settings tab and click the "Generate" button under ',(0,t.jsx)(o.strong,{children:"Generated access token"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsxs)(o.p,{children:['You can now use the below commands to send files to your new dropbox folder located in\n"dropbox/Apps/AutoPi Logfiles". Execute them in the web terminal, or in the SSH terminal by\nprepending ',(0,t.jsx)(o.code,{children:"autopi"})," before the command."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(o.admonition,{type:"note",children:(0,t.jsx)(o.p,{children:"Remember to replace the YOUR_ACCESS_TOKEN with the actual token you received in the last step."})}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"# web terminal\n$ fileutil.upload /var/log/salt/minion gzip=True service=dropbox token=YOUR_ACCESS_TOKEN\n\n# SSH\n$ autopi fileutil.upload /var/log/salt/minion gzip=True service=dropbox token=YOUR_ACCESS_TOKEN\n"})}),"\n",(0,t.jsxs)(o.ol,{start:"5",children:["\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsx)(o.p,{children:"You should now be able to see the uploaded file in your dropbox folder."}),"\n"]}),"\n",(0,t.jsxs)(o.li,{children:["\n",(0,t.jsx)(o.p,{children:"You can also upload the file to dropbox using raw Linux commands. Here are the commands:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:"cmd.run 'gzip --keep -f /var/log/salt/minion'\n"})}),"\n",(0,t.jsx)(o.p,{children:"And then run the following command to upload the data:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:'cmd.run \'curl -X POST https://content.dropboxapi.com/2/files/upload \\\n--header "Authorization: Bearer YOUR_ACCESS_TOKEN" \\\n--header "Dropbox-API-Arg: {\\"path\\": \\"/minion.gz\\"}" \\\n--header "Content-Type: application/octet-stream" \\\n--data-binary @/var/log/salt/minion.gz\'\n'})}),"\n",(0,t.jsx)(o.admonition,{type:"note",children:(0,t.jsxs)(o.p,{children:["If the above command does not work, you can try this one instead (",(0,t.jsx)(o.em,{children:"Same command on a\nsingle line, without the slashes"}),")"]})}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:'cmd.run \'curl -X POST https://content.dropboxapi.com/2/files/upload --header "Authorization: Bearer YOUR_ACCESS_TOKEN" --header "Dropbox-API-Arg: {\\"path\\": \\"/minion.gz\\"}" --header "Content-Type: application/octet-stream" --data-binary @/var/log/salt/minion.gz\'\n'})}),"\n",(0,t.jsx)(o.h2,{id:"log-rotation",children:"Log Rotation"}),"\n",(0,t.jsxs)(o.p,{children:["Every so often the logs on your AutoPi device will ",(0,t.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/Log_rotation",children:"rotate"}),".\nThis essentially means that the current log files will be compressed and renamed so that a new log\nfile can start being used. This is done in order to keep the size of the log files relatively small."]}),"\n",(0,t.jsx)(o.h4,{id:"varlogsaltminion",children:(0,t.jsx)(o.code,{children:"/var/log/salt/minion"})}),"\n",(0,t.jsxs)(o.p,{children:["By default, the salt minion log file is being rotated every week. Also by default, there will be 7\nolder versions of the log file that will be kept on the SD card before being removed. You can\ndouble check those defaults if you read the ",(0,t.jsx)(o.code,{children:"/etc/logrotate.d/salt-common"})," file which has those\ndefinitions."]}),"\n",(0,t.jsx)(o.h4,{id:"varlogsyslog",children:(0,t.jsx)(o.code,{children:"/var/log/syslog"})}),"\n",(0,t.jsxs)(o.p,{children:["By default, the syslog file is being rotated every day. Also by default, there will be 7 older\nversions of the log file that will be kept on the SD card before being removed. You can double check\nthose defaults if you read the ",(0,t.jsx)(o.code,{children:"/etc/logrotate.d/rsyslog"})," file which has those definitions."]})]})}function p(e={}){const{wrapper:o}={...(0,l.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},90511:(e,o,n)=>{n.d(o,{A:()=>i});const i=n.p+"assets/images/dropbox_create_app-c0d297e94db1b02bd649e7a58aa8c3f7.png"}}]);