"use strict";(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[8471],{28453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>r});var n=o(96540);const i={},a=n.createContext(i);function s(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(a.Provider,{value:t},e.children)}},80456:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"developer_guides/installing-a-camera-on-your-autopi","title":"Installing a Camera on Your AutoPi","description":"This guide will explore how you can attach an external USB camera to your AutoPi device and make some use out of it.","source":"@site/docs/developer_guides/installing_a_camera_on_your_autopi.mdx","sourceDirName":"developer_guides","slug":"/developer_guides/installing-a-camera-on-your-autopi","permalink":"/developer_guides/installing-a-camera-on-your-autopi","draft":false,"unlisted":false,"editUrl":"https://github.com/autopi-io/documentation/edit/master/docs/developer_guides/installing_a_camera_on_your_autopi.mdx","tags":[],"version":"current","frontMatter":{"id":"installing-a-camera-on-your-autopi","title":"Installing a Camera on Your AutoPi"},"sidebar":"sidebar","previous":{"title":"Jumpers","permalink":"/developer_guides/jumpers"},"next":{"title":"Enabling Bluetooth on Legacy Devices With STN Chips","permalink":"/developer_guides/enabling_bluetooth_on_TMU_devices"}}');var i=o(74848),a=o(28453);const s={id:"installing-a-camera-on-your-autopi",title:"Installing a Camera on Your AutoPi"},r=void 0,l={},c=[{value:"Setting up Basic Camera Settings",id:"setting-up-basic-camera-settings",level:3},{value:"Recording All the Time",id:"recording-all-the-time",level:3},{value:"Motion Detection",id:"motion-detection",level:3},{value:"Extra Fine Tuning",id:"extra-fine-tuning",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["This guide will explore how you can attach an external USB camera to your ",(0,i.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"})," device and make some use out of it.\nThere is one prerequisite however - you need to be able to SSH into your dongle. We already have a guide on that which you can\ntake a look at ",(0,i.jsx)(t.a,{href:"/developer_guides/how-to-ssh-to-your-device/",children:"here"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Firstly, we need to do some initial setup to get the ",(0,i.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"})," ready to use an external USB web camera. Let's start with the\nsoftware that we're going to use:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://motion-project.github.io/motion_guide.html",children:"motion"})," - Motion is a daemon service that is responsible for communicating\nwith the camera. It'll setup the devices (",(0,i.jsx)(t.code,{children:"/dev/video*"}),") and get them started."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/ccrisan/motioneye",children:"motionEye"})," - MotionEye is a web based frontend for motion. It provides an\neasy to use interface to setup configuration for each camera and also shows what the cameras are currently seeing."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Installing both of them should be as easy as installing any other package on a debian system. We will use the ",(0,i.jsx)(t.code,{children:"apt"})," command.\nThe next command installs motion daemon and its dependencies:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ sudo apt install motion\n"})}),"\n",(0,i.jsx)(t.p,{children:"Let's now prepare for the installation of motioneye - there are some dependencies that need to be installed:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ sudo apt install python-dev libssl-dev libcurl4-openssl-dev libjpeg-dev libz-dev\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now that we've got the dependencies installed, let's install motioneye itself:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ sudo pip install motioneye\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Note"}),": If pillow installation fails, you can try installing it from official repos using ",(0,i.jsx)(t.code,{children:"apt install python-pillow"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"After successfully installing motion and motioneye we now need to prepare some directories for them to use.\nThe next two commands will create the motioneye configuration directory and copy the default configuration file in that directory:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ sudo mkdir -p /etc/motioneye\n$ sudo cp /usr/local/share/motioneye/extra/motioneye.conf.sample /etc/motioneye/motioneye.conf\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now, let's create the directory in which motioneye will save our video files to:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ sudo mkdir -p /var/lib/motioneye\n"})}),"\n",(0,i.jsx)(t.p,{children:"Finally, let's create a service file for motioneye so that the system can automatically start it up:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$ sudo cp /usr/local/share/motioneye/extra/motioneye.systemd-unit-local /etc/systemd/system/motioneye.service\n$ sudo systemctl daemon-reload\n$ sudo systemctl enable motioneye\n$ sudo systemctl restart motioneye\n"})}),"\n",(0,i.jsxs)(t.p,{children:["At this point, the web interface should be running on the device, however you probably won't be able to access it from your computer or\nmobile phone. Instead, it's only accessible from the device itself. This is because there are some firewall settings that have been\nimplemented on the device and we need to add a new exception. We can do that by navigating to the Device > Advanced Settings in ",(0,i.jsx)(t.a,{href:"https://my.autopi.io",children:"my.autopi.io"}),".\nThere, one of the inner tabs called System should contain an entry called Network > Firewall. Let's add the following new entry to the list:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"-A INPUT -s 192.168.4.0/24 -i uap0 -p tcp --dport 8765 -j ACCEPT\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"NOTE"}),": 8765 is only the default port for MotionEye. If you happen to change the port number, please make sure to add the rule\nwith the respective new port number."]}),"\n",(0,i.jsxs)(t.p,{children:["What this entry will do is allow all TCP traffic that comes from the ",(0,i.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"}),"'s WiFi network interface through port 8765 to be accepted.\nThis will allow you to navigate to the following link: local.autopi.io:8765. There you'll finally be able to see the MotionEye frontend interface."]}),"\n",(0,i.jsx)(t.p,{children:"At this point, you should be able to plug in the camera to your device's micro-usb, wait a few seconds and see the video feed on your screen.\nYou should also be able to see the settings for the camera by clicking on the 'burger-menu' button on the top left of the website. If\nyou're unable to see a long list of settings, try reloging as an admin. If this still doesn't do the trick, try restarting the motion and\nmotioneye services using the following commands:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"sudo systemctl restart motion motioneye\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now we will move on to some pointers on how to get started with certain, popular projects."}),"\n",(0,i.jsx)(t.h3,{id:"setting-up-basic-camera-settings",children:"Setting up Basic Camera Settings"}),"\n",(0,i.jsx)(t.p,{children:'Sometimes the image on the camera can be very dim or with a low resolution as a default. The general settings for the camera can be found under\nthe "Video Device" section. Settings such as brightness, contrast, sharpness and video resolution can be set up there. This should allow you to\nfine tune your camera for the environment you\'re looking to use it in. There is also the ability to automatically set the brighness and exposure\nof the camera.'}),"\n",(0,i.jsxs)(t.p,{children:["Furthermore, you're also able to change the default location of where the video files (recordings) are saved. The default location is\n",(0,i.jsx)(t.code,{children:"/var/lib/motioneye/Camera1"}),', however you can change that by going under the "File Storage" section.']}),"\n",(0,i.jsx)(t.p,{children:"There you're also able to setup a webhook or a command to be called whenever a new file has been saved on the file system."}),"\n",(0,i.jsx)(t.h3,{id:"recording-all-the-time",children:"Recording All the Time"}),"\n",(0,i.jsxs)(t.p,{children:["Setting up a constantly recording camera is very simple. All you need to do is to go to your motioneye website\n(local.autopi.io:8765 while connected to the ",(0,i.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"}),' device hotspot) and open the settings for the camera. In the list there should be a section\ncalled "Movies". You will need to turn on the movies section (which will enable the camera to record). In the Recording Mode field, select\n"Continuous Recording" (It\'s of course also possible to have the recording based on motion detection). The rest of the settings can be selected\nbased on personal preference.']}),"\n",(0,i.jsx)(t.h3,{id:"motion-detection",children:"Motion Detection"}),"\n",(0,i.jsxs)(t.p,{children:["Apart from the ability to record only when the camera detects motion, you can also do some other cool things. For example, you\ncan set up a mail notification or a webhook to be called whenever there is some motion. There is also the option to execute a\ncommand on the ",(0,i.jsx)(t.a,{href:"https://www.autopi.io",children:"AutoPi"})," either when a motion is detected or when the motion ends. That is to say, after the camera has started\ndetecting motion, it can also execute a command when there is no more motion detected by it."]}),"\n",(0,i.jsx)(t.p,{children:'You can find those settings under the "Motion Detection" and "Motion Notification" settings. In the Motion Detection section you can\nfine tune how you would like the motion to be detected, with higher or lower thresholds, for specific amount of frames and so on.\n"Motion Notifications" section is where you can setup the triggers to be executed whenever a motion is detected (or after).'}),"\n",(0,i.jsx)(t.h3,{id:"extra-fine-tuning",children:"Extra Fine Tuning"}),"\n",(0,i.jsxs)(t.p,{children:["For the more tech-savvy or adventurous people out there, there is also some configuration options that work directly with motion.\nRemember that MotionEye is actually a front-end application that communicates directly with motion. This means that all the options\nthat are available on MotionEye are also available on Motion, however much more detailed. For example, there are more events that can\nbe used with Motion than there are with MotionEye. One really good example is ",(0,i.jsx)(t.code,{children:"on_camera_lost"})," which will trigger whenever a camera\ncan't be found or when a camera is lost during its work, which allows you to set a notification if your camera stops working."]}),"\n",(0,i.jsxs)(t.p,{children:["You can look at all the configuration options available for Motion in ",(0,i.jsx)(t.a,{href:"https://motion-project.github.io/motion_config.html",children:"this"})," link.\nThe documentation can be a bit overwhelming at first, however the developers have set it up in a neat way where there is a list of\nall the options in alphabetical order first and then a list of the same options based on category.\nAfterwards, there is a long list of the description of each option."]}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["In case you have any questions, don't hesitate to contact us at ",(0,i.jsx)(t.a,{href:"mailto:support@autopi.io",children:"support@autopi.io"}),"."]})})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);