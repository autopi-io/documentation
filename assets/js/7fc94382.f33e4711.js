(self.webpackChunkdocumentation_2=self.webpackChunkdocumentation_2||[]).push([[4423],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return d},kt:function(){return m}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),u=l(a),m=r,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||o;return a?n.createElement(h,i(i({ref:t},d),{},{components:a})):n.createElement(h,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},23508:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return p},contentTitle:function(){return s},metadata:function(){return l},toc:function(){return d},default:function(){return u}});var n=a(22122),r=a(19756),o=(a(67294),a(3905)),i=["components"],p={id:"j1939-getting-started-guide",title:"Getting Started"},s=void 0,l={unversionedId:"getting_started/heavy_duty_vehicles/j1939-getting-started-guide",id:"getting_started/heavy_duty_vehicles/j1939-getting-started-guide",isDocsHomePage:!1,title:"Getting Started",description:"This guide will show how to retrieve data from a vehicle supporting the J1939 protocol. To read more background information about J1939 please see the blog post: J1939 Explained",source:"@site/docs/getting_started/heavy_duty_vehicles/j1939_getting_started_guide.md",sourceDirName:"getting_started/heavy_duty_vehicles",slug:"/getting_started/heavy_duty_vehicles/j1939-getting-started-guide",permalink:"/getting_started/heavy_duty_vehicles/j1939-getting-started-guide",editUrl:"https://github.com/autopi-io/documentation/edit/master/docs/getting_started/heavy_duty_vehicles/j1939_getting_started_guide.md",tags:[],version:"current",frontMatter:{id:"j1939-getting-started-guide",title:"Getting Started"},sidebar:"sidebar",previous:{title:"Data Troubleshooting",permalink:"/getting_started/autopi_mini/mini-data-troubleshooting"},next:{title:"Getting Started",permalink:"/getting_started/electric_vehicles/electric-vehicles-intro"}},d=[{value:"Preconditions",id:"preconditions",children:[]},{value:"Determining the CAN Bus protocol",id:"determining-the-can-bus-protocol",children:[{value:"Determining if the vehicle responds to J1939 VIN queries:",id:"determining-if-the-vehicle-responds-to-j1939-vin-queries",children:[]}]},{value:"Check for Broadcast Data via the CAN Bus sniffer",id:"check-for-broadcast-data-via-the-can-bus-sniffer",children:[]},{value:"Query for Data via PID tester tool",id:"query-for-data-via-pid-tester-tool",children:[]},{value:"Register Vehicle Bus",id:"register-vehicle-bus",children:[]},{value:"Register PID for Request PGN",id:"register-pid-for-request-pgn",children:[]},{value:"Decode Messages (with DBC file)",id:"decode-messages-with-dbc-file",children:[{value:"Create Mapping",id:"create-mapping",children:[]},{value:"Sync DBC File",id:"sync-dbc-file",children:[]},{value:"Test CAN Converter",id:"test-can-converter",children:[]}]},{value:"Setup Loggers",id:"setup-loggers",children:[]}],c={toc:d};function u(e){var t=e.components,p=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},c,p,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This guide will show how to retrieve data from a vehicle supporting the J1939 protocol. To read more background information about J1939 please see the blog post: ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/blog/j1939-explained/"},"J1939 Explained")),(0,o.kt)("h2",{id:"preconditions"},"Preconditions"),(0,o.kt)("p",null,"Before proceeding the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," device must be:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Connected to the vehicle with an appropriate OBD-II adapter cable that connects the vehicles two J1939 ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus wires to pin 6 (high) and 14 (low) of the OBD-II connector on the ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io"},"AutoPi")," device. If you are missing an adapter cable for your specific vehicle please contact ",(0,o.kt)("a",{parentName:"li",href:"mailto:sales@autopi.io"},"sales@autopi.io"),"."),(0,o.kt)("li",{parentName:"ol"},"When initially inserting the device, make sure that the vehicle is powered off."),(0,o.kt)("li",{parentName:"ol"},"Powered on and online in the ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io"},"AutoPi")," ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud")," at ",(0,o.kt)("a",{parentName:"li",href:"https://my.autopi.io"},"https://my.autopi.io"),"."),(0,o.kt)("li",{parentName:"ol"},"Also the ignition of the vehicle must be turned on to ensure the J1939 ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus is active.")),(0,o.kt)("h2",{id:"determining-the-can-bus-protocol"},"Determining the ",(0,o.kt)("a",{parentName:"h2",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Bus protocol"),(0,o.kt)("p",null,"First step is the determine the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus protocol used for the connected vehicle (if you dont already know it). A few steps is required here:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Remove all existing loggers on the device (make sure the loggers chage is synced). This can be done here: ",(0,o.kt)("a",{parentName:"li",href:"https://my.autopi.io"},"https://my.autopi.io")," go to ",(0,o.kt)("em",{parentName:"li"},"Devices")," > ",(0,o.kt)("em",{parentName:"li"},"Select Device")," > ",(0,o.kt)("em",{parentName:"li"},"Loggers"),". You want to remove these, so that they dont interfere with the ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Bus already."),(0,o.kt)("li",{parentName:"ol"},"Remove all existing ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," busses on the vehicle. From the same page click the ",(0,o.kt)("em",{parentName:"li"},"Settings")," button in the top right corner. Click the ",(0,o.kt)("em",{parentName:"li"},"Vehicles Editor")," and remove the ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," busses configured in the bottom of the popup. "),(0,o.kt)("li",{parentName:"ol"},"Configure the vehicle for 24V operation (if its a 24V truck). You can do this on the vehicles editor page that you are add, by clicking the ",(0,o.kt)("em",{parentName:"li"},"Nominal Voltage")," dropdown. "),(0,o.kt)("li",{parentName:"ol"},"You are now set to start the testing for the right ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Bus configuration.")),(0,o.kt)("p",null,"You need to make sure the device is powered on, have good internet connection and that the engine of the vehicle is running. You can do so by following these steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"From terminal in the right hand side screen, run the following command ",(0,o.kt)("inlineCode",{parentName:"li"},"test.ping"),". It should return ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," if the device is online and connected to the ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud"),"."),(0,o.kt)("li",{parentName:"ol"},"Again from the terminal run the following command ",(0,o.kt)("inlineCode",{parentName:"li"},"obd.battery"),". This command command will return the Voltage of the Auxilirary battery in the vehicle. If its a 24V type of battery you should see a value somewhere between 25-28V. If its close to 25V it means the engine is not running. If its closer to 28V it means the engine is running and ECU's are powered up. A good indicator is a value above 26.5V.")),(0,o.kt)("p",null,"With these checks passed you can now continue to find the protocol and baudrate settings. With the vehicle's engine running, first try to listen to passive ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," traffic. One of these commands should show some data (raw). Once you find which command returns data, note down the protocol and baudrate for this vehicle:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=32 baudrate=500000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=32 baudrate=250000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=32 baudrate=125000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=31 baudrate=500000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=31 baudrate=250000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=31 baudrate=125000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=52 baudrate=500000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=52 baudrate=250000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=52 baudrate=125000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=51 baudrate=500000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=51 baudrate=250000"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"obd.monitor duration=5 verify=False protocol=51 baudrate=125000")))),(0,o.kt)("p",null,"To determine whether any of the raw data is J1939, you can do 1 of 2 things:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Check on the ",(0,o.kt)("a",{parentName:"li",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud")," whether there is any data coming in. Note, that you would only be able to see this if the protocol configuration of the device matches that of the vehicle."),(0,o.kt)("li",{parentName:"ol"},"Look for the EEC1 frame. If the vehicle supports J1939, it will almost certainly have this. In the data returned by the monitor command, look for a frame where the 3th to 6th characters are ",(0,o.kt)("inlineCode",{parentName:"li"},"F004"),". For example, if the full frame is ",(0,o.kt)("inlineCode",{parentName:"li"},"18F0040012AB331288112244"),", you can see ",(0,o.kt)("inlineCode",{parentName:"li"},"F004")," at the beginning.")),(0,o.kt)("h3",{id:"determining-if-the-vehicle-responds-to-j1939-vin-queries"},"Determining if the vehicle responds to J1939 VIN queries:"),(0,o.kt)("p",null,"If you've found the protocol, baudrate combination which works, use the same combination to check for the VIN query. Run the following command. It should return the VIN string for the vehicle:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"obd.query vin mode=FEEC pid=x00 header=18ea00f9 formula='str(message.data)' verify=false force=true protocol=<PROTOCOL> baudrate=<BAUDRATE>"))),(0,o.kt)("h2",{id:"check-for-broadcast-data-via-the-can-bus-sniffer"},"Check for Broadcast Data via the ",(0,o.kt)("a",{parentName:"h2",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Bus sniffer"),(0,o.kt)("p",null,"As most J1939 messages are broadcast we start by checking if we can see any data on the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," bus."),(0,o.kt)("p",null,"On ",(0,o.kt)("a",{parentName:"p",href:"https://my.autopi.io"},"https://my.autopi.io")," go to ",(0,o.kt)("em",{parentName:"p"},"Devices")," > ",(0,o.kt)("em",{parentName:"p"},"Select Device")," > ",(0,o.kt)("em",{parentName:"p"},"CAN Analyzer")," > ",(0,o.kt)("em",{parentName:"p"},"Sniffer"),"."),(0,o.kt)("p",null,"Select one of the following J1939 protocols that fits your vehicle in regards to 11bit or 29bit header:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"[41] J1939 (11bit, 250kbps)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"[42] J1939 (29bit, 250kbps)"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Optional:")," Change the baud rate if predefined value of ",(0,o.kt)("inlineCode",{parentName:"p"},"250000")," is incorrect. ",(0,o.kt)("inlineCode",{parentName:"p"},"500000")," is a typical alternative."),(0,o.kt)("p",null,"Click the ",(0,o.kt)("em",{parentName:"p"},"Sniff")," button to start recording ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages sent on the J1939 bus. An example of a recording result is shown in below screenshot."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The start and end of the recording are indicated audibly with loud beep sounds played by the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," device."))),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"j1939_can_sniffer",src:a(59587).Z})),(0,o.kt)("p",null,"If no data is returned, try:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Change the protocol and/or baud rate combinations."),(0,o.kt)("li",{parentName:"ol"},"Increase the recording duration from default ",(0,o.kt)("inlineCode",{parentName:"li"},"1")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"10")," seconds."),(0,o.kt)("li",{parentName:"ol"},"Continue to the next section describing how to query for data.")),(0,o.kt)("h2",{id:"query-for-data-via-pid-tester-tool"},"Query for Data via PID tester tool"),(0,o.kt)("p",null,"Some data is only available on request. This means a J1939 request message must be sent in order to get a data response. This can be done using the PID tester tool."),(0,o.kt)("p",null,"In the ",(0,o.kt)("em",{parentName:"p"},"CAN Analyzer")," select the ",(0,o.kt)("em",{parentName:"p"},"PID Tester")," tab."),(0,o.kt)("p",null,"First the J1939 protocol and baud rate must be specified in the same way as described previously."),(0,o.kt)("p",null,"Next the J1939 request message must be specififed. It consists of a header and a data part. "),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Header:")," ",(0,o.kt)("inlineCode",{parentName:"p"},"18 EA 00 F9")," is broken down into:"),(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"18")," contains priority of 6."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"EA 00")," is PGN 59904 (Request PGN)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"F9")," is source address 249 (Service Tool).")),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Data:")," ",(0,o.kt)("inlineCode",{parentName:"p"},"00 C1 00")," is the specific PGN that is requested. In this example PGN 49408 (Diagnostic Readiness 2).")),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"j1939_pgn_query",src:a(54986).Z})," "),(0,o.kt)("p",null,"In above screenshot we query PGN 61444 (Electronic Engine Controller 1) which among other values contains SPN 190 (Engine Speed)."),(0,o.kt)("h2",{id:"register-vehicle-bus"},"Register Vehicle Bus"),(0,o.kt)("p",null,"Once a J1939 bus has been identified and tested, it is recommended to register it on the vehicle's profile."),(0,o.kt)("p",null,"Go to ",(0,o.kt)("em",{parentName:"p"},"Devices")," > ",(0,o.kt)("em",{parentName:"p"},"Select Device")," > ",(0,o.kt)("em",{parentName:"p"},"Settings")," > ",(0,o.kt)("em",{parentName:"p"},"Vehicles Editor")," and click on ",(0,o.kt)("em",{parentName:"p"},"Create")," button below ",(0,o.kt)("em",{parentName:"p"},"CAN Buses"),". Fill in the relevant values for name, protocol and baud rate."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create_j1939_vehicle_bus",src:a(55169).Z})),(0,o.kt)("h2",{id:"register-pid-for-request-pgn"},"Register PID for Request PGN"),(0,o.kt)("p",null,"This section may be skipped if you only receive broadcast J1939 messages. But if you need to query for a specific PGN\nit is recommended to register the request PGN as a PID in the ",(0,o.kt)("em",{parentName:"p"},"OBD Library"),". It can then later be used to easily set up loggers."),(0,o.kt)("p",null,"Go to ",(0,o.kt)("em",{parentName:"p"},"OBD Library")," > ",(0,o.kt)("em",{parentName:"p"},"Create")," > ",(0,o.kt)("em",{parentName:"p"},"PID"),"."),(0,o.kt)("p",null,"Enter the informations previously verified using the ",(0,o.kt)("em",{parentName:"p"},"PID Tester"),"."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create_pid_for_j1939_request_pgn",src:a(24054).Z})),(0,o.kt)("h4",{id:"pid-details"},"PID Details"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Name:")," Short name of the PGN requested."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Description:")," Optional description of the PGN requested."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Mode:")," Hexadecimal value ",(0,o.kt)("inlineCode",{parentName:"p"},"00")," is specified here."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Code:")," The hexadecimal representation of the requsted PGN number 61444 (Electronic Engine Controller 1)."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Header:")," The header to request a PGN:"),(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"18")," contains priority of 6."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"EA 00")," is PGN 59904 (Request PGN)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"F9")," is source address 249 (Service Tool)."))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"It is recommended to specify how many messages/frames are expected to be returned by the query. This is done by unfolding the section ",(0,o.kt)("em",{parentName:"p"},"Enhanced PID")," and entering the number of messages under ",(0,o.kt)("em",{parentName:"p"},"Frames"),". This helps reduce the total query time (better performance) because the waiting timeout for the last message is skipped."))),(0,o.kt)("h4",{id:"used-by-vehicles"},"Used by Vehicle(s)"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Vehicle Bus(es):"),"  Specify which bus(es) the PID is to be associated with. The previously created J1939 bus is selected.")),(0,o.kt)("h2",{id:"decode-messages-with-dbc-file"},"Decode Messages (with DBC file)"),(0,o.kt)("p",null,"After receiving the raw J1939 ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages they must be decoded to get the actual measurement values. This can be done using the built-in CAN database functionality."),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," database contains definitions of how the individual ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages are structured. Each ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message can consist of one or more ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signals, each of which typically contains a single measurement value (eg. temperature, speed, RPM or the like)."),(0,o.kt)("p",null,"As an exmaple, the J1939 PGN 61444 (Electronic Engine Controller 1) contains 8 SPNs in total. It can be mapped to a ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message with 8 ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signals as shown below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PGN 61444 (Electronic Engine Controller 1)                            ---\x3e  CAN message\n  SPN 899 (Engine Torque Mode)                                        ---\x3e    CAN signal #1\n  SPN 899 (Engine Torque Mode)                                        ---\x3e    CAN signal #2\n  SPN 4154 (Actual Engine - Percent Torque)                           ---\x3e    CAN signal #3\n  SPN 512 (Driver's Demand Engine - Percent Torque)                   ---\x3e    CAN signal #4\n  SPN 513 (Actual Engine - Percent Torque)                            ---\x3e    CAN signal #5\n  SPN 190 (Engine Speed)                                              ---\x3e    CAN signal #6\n  SPN 1483 (Source Address of Controlling Device for Engine Control)  ---\x3e    CAN signal #7\n  SPN 1675 (Engine Starter Mode)                                      ---\x3e    CAN signal #8\n  SPN 2432 (Engine Demand \u2013 Percent Torque)                           ---\x3e    CAN signal #9\n")),(0,o.kt)("p",null,"When all (or only a few selected) ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages have be defined they will need to be synchronized to the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," device and stored in the form of a DBC file. The synchronization is handled automatically by to ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud")," management system. Using this DBC file, the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," device can decode raw ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages into readable measurement values. The decoded data can then be uploaded to the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud"),", stored locally or sent to any custom endpoint."),(0,o.kt)("h3",{id:"create-mapping"},"Create Mapping"),(0,o.kt)("p",null,"To create a mapping for a ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message to be be decoded go to ",(0,o.kt)("em",{parentName:"p"},"OBD Library")," > ",(0,o.kt)("em",{parentName:"p"},"Create")," > ",(0,o.kt)("em",{parentName:"p"},"CAN"),"."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create_j1939_can_message",src:a(72716).Z})," "),(0,o.kt)("p",null,"In above screenshot, we register a ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message mapping for PGN 61444 (Electronic Engine Controller 1):"),(0,o.kt)("h4",{id:"can-message"},(0,o.kt)("a",{parentName:"h4",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Message"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Name:")," Short name to identify the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Description:")," Optional description of the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Header:")," ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message header for PGN 61444:"),(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"8C")," contains priority of 6 but has no actual significance."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"F004")," is the hexadecimal representation of PGN number 61444."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"FE")," is source address 254 (Null Address) but has no actual significance.")),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Bytes:")," 8 is the number of data bytes that the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message contains."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Sender:")," Identifier of the ECU that sent the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message. Enter ",(0,o.kt)("inlineCode",{parentName:"p"},"XXX")," or similar if unknown.")),(0,o.kt)("h4",{id:"can-signal-1"},(0,o.kt)("a",{parentName:"h4",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Signal #1"),(0,o.kt)("p",null,"In the above screenshot we only show how to map SPN 190 (Engine Speed) but the procedure the same when adding more."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Name:")," Short name to identify the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signal."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Description:")," Optional description of the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signal."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Endian:")," Sequence of bytes is little-endian - least significant bits first."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Start:")," Bitwise start index of the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signal value within the data part of the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message. When it comes to big-endian indexing is straightforward, but for little-endian it is more complex."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Length:")," Bit length of the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signal value."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Sign:")," Unsigned integer value - no negative values."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Factor:")," A factor of ",(0,o.kt)("inlineCode",{parentName:"p"},"0.125")," to be multiplied by the value in order to get the actual measurement value."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Offset:")," No offset to be added to the value."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Unit:")," Unit of the value is RPM (Revolutions per minute)."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Min:")," The maximum possible value is undefined."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Max:")," The minimum possible value is undefined."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Receivers:")," Identifiers for ECUs that use the signal value.")),(0,o.kt)("h4",{id:"used-by-vehicles-1"},"Used by Vehicle(s)"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Vehicle Bus(es):"),"  Specify which bus(es) the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message is to be associated with. The previously created J1939 bus is selected.")),(0,o.kt)("h3",{id:"sync-dbc-file"},"Sync DBC File"),(0,o.kt)("p",null,"After the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message has been created, it must be synchronized to the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," device. This is done in the same way as all other changes; applied immediately on request if the device is online or queued and applied the next time the device is back online."),(0,o.kt)("p",null,"When synchronizing, the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages are stored in one or more DBC files located on the file system below the path:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/opt/autopi/obd/can/db/protocol_<ID>.dbc\n")),(0,o.kt)("p",null,"A separate DBC file is created on the device for each associated vehicle bus protocol.\nIn the above example, protocol ",(0,o.kt)("inlineCode",{parentName:"p"},"[42] J1939 (29bit, 250kbps)")," is used. Therefore, the synchronized DBC file will be found at: ",(0,o.kt)("inlineCode",{parentName:"p"},"/opt/autopi/obd/can/db/protocol_42.dbc")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"As default, all created ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages and associated ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signals are synchronized to the DBC file. But if one or more ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signals\nare used in loggers only the used ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," signals and ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages are included in the DBC file."))),(0,o.kt)("h3",{id:"test-can-converter"},"Test ",(0,o.kt)("a",{parentName:"h3",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," Converter"),(0,o.kt)("p",null,"To easily test ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," message conversion with a DBC file, the following terminal command can be executed. It performs a single workflow that queries a PGN and then converts the raw response message using the DBC file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"obd.manage run handler=\"query\" args=\"['EEC1']\" kwargs=\"{'mode': '00', 'pid': 'F004', 'header': '18EA00F9', 'force': true}\" converter=\"can\"\n")),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create_pid_for_j1939_request_pgn",src:a(87032).Z})),(0,o.kt)("h4",{id:"command-breakdown"},"Command Breakdown"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},"obd.manage"))," is the ",(0,o.kt)("a",{parentName:"p",href:"/core/commands/core-commands-obd/#obdmanage"},"command")," to execute."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},"run"))," a ",(0,o.kt)("a",{parentName:"p",href:"/core/services/core-services-intro/#workflows"},"workflow")," directly."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},'handler="query"'))," specifies the handler of the workflow to be called."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},'args="',"['EEC1']",'"'))," specifices the arguments of the handler. The value consists of an embedded JSON array."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},"kwargs=\"{'mode': '00', 'pid': 'F004', 'header': '18EA00F9', 'force': true}\""))," specifices the keyword arguments of the handler. The value consists of an embedded JSON dictionary."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},'converter="can"'))," specifies a converter in the workflow to be called after the handler. Here we use the ",(0,o.kt)("a",{parentName:"p",href:"/core/services/core-services-obd-manager/#can"},"CAN")," converter.")),(0,o.kt)("h2",{id:"setup-loggers"},"Setup Loggers"),(0,o.kt)("p",null,"To receive the J1939 data in the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/software-platform/cloud-management"},"Cloud"),", loggers must first be set up on the device. Go to ",(0,o.kt)("em",{parentName:"p"},"Device")," > ",(0,o.kt)("em",{parentName:"p"},"Loggers")," and create loggers\nfor the respective PIDs and or ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io/hardware/autopi-canfd-pro"},"CAN")," messages. After a logger has been created, it must be synchronized to the ",(0,o.kt)("a",{parentName:"p",href:"https://www.autopi.io"},"AutoPi")," device, just like any other change."))}u.isMDXComponent=!0},72716:function(e,t,a){"use strict";t.Z=a.p+"assets/images/create_j1939_can_message-0fd78e4fc11b0da14116719737494341.png"},55169:function(e,t,a){"use strict";t.Z=a.p+"assets/images/create_j1939_vehicle_bus-ebc54f7532d56110774f4453898f6324.png"},24054:function(e,t,a){"use strict";t.Z=a.p+"assets/images/create_pid_for_j1939_request_pgn-97d849bf809f741e91e7fd219dbd74af.png"},59587:function(e,t,a){"use strict";t.Z=a.p+"assets/images/j1939_can_sniffer-56f576c4f54561ce8bdba4066d0070a3.png"},54986:function(e,t,a){"use strict";t.Z=a.p+"assets/images/j1939_pgn_query-5a2ba34e5914a0b2d75c7909254402b3.png"},87032:function(e,t,a){"use strict";t.Z=a.p+"assets/images/run_j1939_query_workflow-0ac15c9112dc82e5d84988f18fef930d.png"}}]);